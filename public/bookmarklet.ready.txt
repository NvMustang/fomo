javascript:!function(){"use strict";window.location.href.includes("/events/")&&window.location.hostname.includes("facebook.com")?window.__FOMO_BOOKMARKLET_ACTIVE||(window.__FOMO_BOOKMARKLET_ACTIVE=!0,async function(){try{!function(e,t,o){const n=document.createElement("div");n.id="fomo-bookmarklet-modal",n.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            width: 400px;\n            max-height: calc(100vh - 40px);\n            background: white;\n            border-radius: 8px;\n            padding: 20px;\n            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n            z-index: 999999;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            display: flex;\n            flex-direction: column;\n            overflow: hidden;\n        ";const r=document.createElement("div");r.style.cssText="\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 16px;\n            flex-shrink: 0;\n            cursor: move;\n            user-select: none;\n        ";const s=document.createElement("h2");s.textContent="üìÖ Ajouter l'√©v√©nement √† FOMO",s.style.cssText="margin: 0; font-size: 18px; color: #333; flex: 1;";const a=document.createElement("button");a.type="button",a.innerHTML="√ó",a.style.cssText="\n            background: none;\n            border: none;\n            font-size: 28px;\n            color: #666;\n            cursor: pointer;\n            padding: 0;\n            width: 30px;\n            height: 30px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            line-height: 1;\n            border-radius: 4px;\n        ",a.onclick=()=>{document.body.contains(n)&&document.body.removeChild(n),window.__FOMO_BOOKMARKLET_ACTIVE=!1,o()},a.onmouseover=()=>{a.style.background="#f0f0f0"},a.onmouseout=()=>{a.style.background="none"},r.appendChild(s),r.appendChild(a);let l=!1,i=0,c=0,d=0,u=0;r.onmousedown=e=>{if("BUTTON"===e.target.tagName||e.target.closest("button"))return;l=!0,i=e.clientX,c=e.clientY;const t=n.getBoundingClientRect();d=t.left,u=t.top,n.style.transition="none",document.body.style.userSelect="none"},document.addEventListener("mousemove",e=>{if(!l)return;e.preventDefault();const t=e.clientX-i,o=e.clientY-c;let r=d+t,s=u+o;const a=window.innerWidth-n.offsetWidth,m=window.innerHeight-n.offsetHeight;r=Math.max(0,Math.min(r,a)),s=Math.max(0,Math.min(s,m)),n.style.left=r+"px",n.style.top=s+"px",n.style.right="auto",n.style.bottom="auto"}),document.addEventListener("mouseup",()=>{l&&(l=!1,n.style.transition="",document.body.style.userSelect="")});const m=document.createElement("div");m.style.cssText="\n            overflow-y: auto;\n            overflow-x: hidden;\n            flex: 1;\n            padding-right: 8px;\n        ";const p=document.createElement("form");function g(e,t,o,n=!1,r="text"){const s=document.createElement("div");s.style.cssText="display: flex; flex-direction: column; gap: 4px;";const a=document.createElement("label");let l;return a.textContent=e+(n?" *":""),a.style.cssText="font-weight: 600; color: #555; font-size: 14px;","textarea"===r?(l=document.createElement("textarea"),l.rows=4):(l=document.createElement("input"),l.type=r),l.name=t,"number"===r?(l.value=null!=o?o+"":"0",l.min="0"):l.value=o||"",l.required=n,l.style.cssText="\n                padding: 6px 10px;\n                border: 1px solid #ddd;\n                border-radius: 4px;\n                font-size: 13px;\n                font-family: inherit;\n                width: 100%;\n                box-sizing: border-box;\n            ",s.appendChild(a),s.appendChild(l),{container:s,input:l}}p.style.cssText="display: flex; flex-direction: column; gap: 12px;";const v=g("URL","url",e.url,!0);v.input.readOnly=!0,v.input.style.background="#f5f5f5";const k=g("Titre","title",e.title,!0),O=g("Description","description",e.description,!0,"textarea");let f="",h="";if(e.start)try{console.log("üìÖ [FOMO Bookmarklet] Date d√©but ISO re√ßue:",e.start);const t=new Date(e.start);if(isNaN(t.getTime()))console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Date d√©but invalide:",e.start);else{const e=t.getFullYear();f=`${e}-${(t.getMonth()+1+"").padStart(2,"0")}-${(t.getDate()+"").padStart(2,"0")}T${(t.getHours()+"").padStart(2,"0")}:${(t.getMinutes()+"").padStart(2,"0")}`,console.log("üìÖ [FOMO Bookmarklet] Date d√©but convertie pour datetime-local:",f)}}catch(t){console.error("‚ùå [FOMO Bookmarklet] Erreur conversion date d√©but:",t,e.start)}else console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Pas de date d√©but dans eventData");if(e.end)try{console.log("üìÖ [FOMO Bookmarklet] Date fin ISO re√ßue:",e.end);const t=new Date(e.end);if(isNaN(t.getTime()))console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Date fin invalide:",e.end);else{const e=t.getFullYear();h=`${e}-${(t.getMonth()+1+"").padStart(2,"0")}-${(t.getDate()+"").padStart(2,"0")}T${(t.getHours()+"").padStart(2,"0")}:${(t.getMinutes()+"").padStart(2,"0")}`,console.log("üìÖ [FOMO Bookmarklet] Date fin convertie pour datetime-local:",h)}}catch(t){console.error("‚ùå [FOMO Bookmarklet] Erreur conversion date fin:",t,e.end)}const x=g("Date de d√©but (ISO)","start",f||e.start,!0,"datetime-local"),b=g("Date de fin (ISO)","end",h||e.end,!1,"datetime-local"),y=g("Nom du lieu","venue_name",e.venue_name,!1),M=g("Adresse du lieu","address",e.address,!0),w=g("Organisateur","host",e.host,!1),C=g("Image de couverture (URL)","cover",e.cover,!0),F=g("Nombre de participants","attending_count",e.attending_count||"",!1,"text"),B=g("Nombre d'int√©ress√©s","interested_count",e.interested_count||"",!1,"text");console.log("üìÖ [FOMO Bookmarklet] Valeur finale champ date d√©but:",x.input.value),console.log("üìÖ [FOMO Bookmarklet] Valeur finale champ date fin:",b.input.value),p.appendChild(v.container),p.appendChild(k.container),p.appendChild(O.container),p.appendChild(x.container),p.appendChild(b.container),p.appendChild(y.container),p.appendChild(M.container),p.appendChild(w.container),p.appendChild(C.container),p.appendChild(F.container),p.appendChild(B.container),m.appendChild(r),m.appendChild(p);const E=document.createElement("div");E.style.cssText="display: flex; gap: 12px; justify-content: flex-end; margin-top: 16px; padding-top: 16px; border-top: 1px solid #eee; flex-shrink: 0;";const S=document.createElement("button");S.type="button",S.textContent="Annuler",S.style.cssText="\n            padding: 8px 16px;\n            border: 1px solid #ccc;\n            background: #f5f5f5;\n            color: #333;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n            min-width: 80px;\n            flex-shrink: 0;\n        ",S.onclick=()=>{document.body.contains(n)&&document.body.removeChild(n),window.__FOMO_BOOKMARKLET_ACTIVE=!1,o()};const I=document.createElement("button");I.type="button",I.textContent="Envoyer",I.style.cssText="\n            padding: 8px 16px;\n            border: none;\n            background: #1877f2;\n            color: white;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 600;\n            min-width: 80px;\n            flex-shrink: 0;\n        ",I.onclick=()=>{console.log("üîò [FOMO Bookmarklet] Bouton Envoyer cliqu√©");const e=new Event("submit",{bubbles:!0,cancelable:!0});p.dispatchEvent(e)},E.appendChild(S),E.appendChild(I),p.onsubmit=async e=>{if(e.preventDefault(),console.log("üîò [FOMO Bookmarklet] Formulaire soumis"),!k.input.value.trim())return void alert("Le titre est obligatoire");if(!O.input.value.trim())return void alert("La description est obligatoire");if(!x.input.value.trim())return void alert("La date de d√©but est obligatoire");if(!M.input.value.trim())return void alert("L'adresse est obligatoire (n√©cessaire pour le g√©ocodage)");if(!C.input.value.trim())return void alert("L'image de couverture est obligatoire");let t=x.input.value;if("datetime-local"===x.input.type)try{const e=new Date(x.input.value);isNaN(e.getTime())||(t=e.toISOString())}catch(e){return void alert("Format de date invalide")}let o=b.input.value;if(b.input.value&&"datetime-local"===b.input.type)try{const e=new Date(b.input.value);isNaN(e.getTime())||(o=e.toISOString())}catch(e){o=""}const n={source:"facebook",url:v.input.value.trim(),title:k.input.value.trim(),description:O.input.value.trim(),start:t,address:M.input.value.trim(),cover:C.input.value.trim()};o&&o.trim()&&(n.end=o);const r=y.input.value.trim();r&&(n.venue_name=r);const s=w.input.value.trim();s&&(n.host=s);const a=F.input.value.trim();a&&(n.attending_count=a);const l=B.input.value.trim();l&&(n.interested_count=l),I.disabled=!0,I.textContent="Envoi...",console.log("üì§ [FOMO Bookmarklet] Envoi du payload:",n);try{await(async e=>{console.log("üöÄ [FOMO Bookmarklet] Callback onConfirm appel√© avec payload:",e);try{const t=await function(e,t){return console.log("üì§ [FOMO Bookmarklet] Envoi des donn√©es via formulaire POST..."),new Promise((o,n)=>{const r="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():`req_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,s=window.location.origin,a=document.createElement("form");a.method="POST",a.action="https://fomo-swart.vercel.app/api/ingest/event-form",a.target="fomo-bookmarklet-receiver",a.style.cssText="position: absolute; left: -9999px; opacity: 0; pointer-events: none;";const l=document.createElement("input");l.type="hidden",l.name="apiKey",l.value=t,a.appendChild(l);const i=document.createElement("input");i.type="hidden",i.name="requestId",i.value=r,a.appendChild(i);const c=document.createElement("input");c.type="hidden",c.name="expectedOrigin",c.value=s,a.appendChild(c);for(const[t,o]of Object.entries(e))if(null!=o){const e=document.createElement("input");e.type="hidden",e.name=t,e.value="string"==typeof o?o:JSON.stringify(o),a.appendChild(e)}document.body.appendChild(a);let d=null;const u=e=>{console.log("üì® [FOMO Bookmarklet] Message re√ßu:",{origin:e.origin,type:e.data?.type,requestId:e.data?.requestId,expectedRequestId:r});const t=["https://fomo-swart.vercel.app"];if(t.some(t=>{const o=t.replace("https://","").replace("http://","").split(":")[0];return e.origin.includes(o)})){if("FOMO_INGEST_RESPONSE"===e.data?.type&&e.data?.requestId===r){console.log("‚úÖ [FOMO Bookmarklet] R√©ponse re√ßue:",e.data),d&&clearTimeout(d),window.removeEventListener("message",u),document.body.contains(a)&&document.body.removeChild(a);try{const e=window.open("","fomo-bookmarklet-receiver");e&&!e.closed&&e.close()}catch(e){}e.data.ok?o({ok:!0,id:e.data.id,duplicate:e.data.duplicate||!1}):n(Error(e.data.error||"Erreur inconnue"))}}else console.log("‚ö†Ô∏è [FOMO Bookmarklet] Message ignor√© - origine incorrecte:",e.origin,"attendu:",t)};window.addEventListener("message",u),console.log("üì§ [FOMO Bookmarklet] Soumission du formulaire POST..."),console.log("üì§ [FOMO Bookmarklet] RequestId:",r),console.log("üì§ [FOMO Bookmarklet] ExpectedOrigin:",s),a.submit(),setTimeout(()=>{try{const e=window.open("","fomo-bookmarklet-receiver");e&&!e.closed?console.log("‚úÖ [FOMO Bookmarklet] Popup ouverte avec succ√®s"):console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Popup non accessible ou ferm√©e")}catch(e){console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Impossible de v√©rifier la popup:",e)}},500),d=setTimeout(()=>{console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Timeout apr√®s 10 secondes - pas de r√©ponse du serveur"),window.removeEventListener("message",u),document.body.contains(a)&&document.body.removeChild(a),n(Error("Timeout - la popup n'a pas r√©pondu. V√©rifiez que les popups ne sont pas bloqu√©es."))},1e4)})}(e,"LaFomoCrew");console.log("‚úÖ [FOMO Bookmarklet] √âv√©nement cr√©√©:",t);const o=document.querySelector("#fomo-bookmarklet-modal");if(o){const e=o.querySelector("div");if(e){const n=document.createElement("div");n.style.cssText="\n                                padding: 12px;\n                                margin-top: 12px;\n                                border-radius: 4px;\n                                background: #d4edda;\n                                color: #155724;\n                                font-size: 14px;\n                                text-align: center;\n                            ",t.ok?t.duplicate?n.textContent="‚ö†Ô∏è Doublon d√©tect√©. L'√©v√©nement existe d√©j√† ‚úÖ\nID: "+t.id:n.textContent="√âv√©nement envoy√© ‚úÖ\nID: "+t.id:(n.style.background="#f8d7da",n.style.color="#721c24",n.textContent="‚ùå Erreur: "+(t.error||"Erreur inconnue")),e.appendChild(n),setTimeout(()=>{o&&document.body.contains(o)&&document.body.removeChild(o),window.__FOMO_BOOKMARKLET_ACTIVE=!1},1e3)}else t.ok?t.duplicate?alert("‚ö†Ô∏è Doublon d√©tect√©. L'√©v√©nement existe d√©j√† ‚úÖ\nID: "+t.id):alert("√âv√©nement envoy√© ‚úÖ\nID: "+t.id):alert("‚ùå Erreur: "+(t.error||"Erreur inconnue")),o&&document.body.contains(o)&&document.body.removeChild(o),window.__FOMO_BOOKMARKLET_ACTIVE=!1}else t.ok?t.duplicate?alert("‚ö†Ô∏è Doublon d√©tect√©. L'√©v√©nement existe d√©j√† ‚úÖ\nID: "+t.id):alert("√âv√©nement envoy√© ‚úÖ\nID: "+t.id):alert("‚ùå Erreur: "+(t.error||"Erreur inconnue")),window.__FOMO_BOOKMARKLET_ACTIVE=!1}catch(e){console.error("‚ùå [FOMO Bookmarklet] Erreur dans callback onConfirm:",e);const t=document.querySelector("#fomo-bookmarklet-modal");if(t){const o=t.querySelector("div");if(o){const t=document.createElement("div");t.style.cssText="\n                                padding: 12px;\n                                margin-top: 12px;\n                                border-radius: 4px;\n                                background: #f8d7da;\n                                color: #721c24;\n                                font-size: 14px;\n                                text-align: center;\n                            ",t.textContent="‚ùå Erreur: "+(e.message||"Erreur inconnue"),o.appendChild(t)}}if(t){const e=t.querySelectorAll('button[type="button"]');for(const t of e)if("Envoi..."===t.textContent.trim()||"Envoyer"===t.textContent.trim()){t.disabled=!1,t.textContent="Envoyer";break}}}})(n),console.log("‚úÖ [FOMO Bookmarklet] onConfirm termin√© avec succ√®s")}catch(e){console.error("‚ùå [FOMO Bookmarklet] Erreur dans onConfirm:",e),I.disabled=!1,I.textContent="Envoyer",alert("Erreur: "+(e.message||"Erreur inconnue"))}},n.appendChild(m),n.appendChild(E);const T=e=>{"Escape"===e.key&&(document.body.contains(n)&&document.body.removeChild(n),window.__FOMO_BOOKMARKLET_ACTIVE=!1,document.removeEventListener("keydown",T),o())};document.addEventListener("keydown",T),document.body.appendChild(n)}(await async function(){const e={source:"facebook",url:window.location.href,title:"",description:"",start:"",end:"",timezone:"Europe/Brussels",venue_name:"",address:"",host:"",attending_count:"",interested_count:"",cover:""};try{const t=document.querySelector('[role="main"]')||document.body;console.log("üîç [FOMO Bookmarklet] === STRAT√âGIE STRUCTURE CONTENEUR ===");const o=t.querySelectorAll("h1");for(const x of o){const b=x.textContent.trim();if(!b||3>b.length||b.length>200)continue;let y=x.parentElement,M=0;const w=6;for(;y&&w>M;){const C=Array.from(y.children).filter(e=>"DIV"===e.tagName&&e.children.length>0);if(C.length>=3){const F=C.find(e=>e.contains(x));if(F){const B=C.indexOf(F);if(C[0]&&!e.start){const E=C[0].textContent.trim();E&&E.length>5&&console.log("üìÖ [FOMO Bookmarklet] Date trouv√©e via structure:",E)}if(!e.title&&b&&(e.title=b,console.log("‚úÖ [FOMO Bookmarklet] Titre trouv√© via structure:",b)),C.length>B+1){const S=C[B+1].textContent.trim();if(S&&S.length>=2&&200>S.length&&(!e.title||S.toLowerCase()!==e.title.toLowerCase()&&!S.toLowerCase().includes(e.title.toLowerCase())&&!e.title.toLowerCase().includes(S.toLowerCase())))if(S.includes(",")){const I=S.split(",").map(e=>e.trim());if(I.length>=2){const T=I[I.length-2];T&&T.length>=2&&100>T.length&&(e.venue_name||(e.venue_name=T,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu (ville) trouv√© via structure:",T)),e.address||(e.address=S,console.log("‚úÖ [FOMO Bookmarklet] Adresse trouv√©e via structure:",S)))}}else e.venue_name||(e.venue_name=S,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu trouv√© via structure:",S))}if(e.title){console.log("‚úÖ [FOMO Bookmarklet] Structure conteneur identifi√©e et exploit√©e");break}}}y=y.parentElement,M++}if(e.title)break}if(!e.title){const A=document.querySelector('h1[data-testid="event-permalink-event-name"]');if(A&&A.textContent.trim())e.title=A.textContent.trim();else{const _=t.querySelectorAll("h1");for(const L of _){const D=L.textContent.trim();if(D&&D.length>3&&200>D.length){e.title=D;break}}}}const n=t.querySelectorAll('[role="button"]');let r=!1;for(const N of n){const q=N.textContent.trim().toLowerCase(),j="voir plus"===q||"en voir plus"===q||"see more"===q||q.includes("voir plus")||q.includes("see more"),R="voir moins"===q||"see less"===q||q.includes("moins")||q.includes("less");if(j&&!R)try{console.log('üîΩ [FOMO Bookmarklet] Clic sur bouton "Voir plus" pour d√©plier la description:',q),N.click(),r=!0,await new Promise(e=>setTimeout(e,500));break}catch(K){console.warn('‚ö†Ô∏è [FOMO Bookmarklet] Erreur lors du clic sur "Voir plus":',K)}}r||console.log('‚ÑπÔ∏è [FOMO Bookmarklet] Aucun bouton "Voir plus" trouv√© ou description d√©j√† d√©pli√©e'),console.log("üìù [FOMO Bookmarklet] === D√âBUT EXTRACTION DESCRIPTION ===");let s=null;const a=t.querySelectorAll("div.html-div.xdj266r.x14z9mp.xat24cr.x1lziwak");console.log("üìù [FOMO Bookmarklet] Nombre de divs html-div.xdj266r trouv√©s:",a.length);for(const z of a){const U=z.querySelector('span[dir="auto"][class*="xdmh292"][class*="x15dsfln"][class*="x140p0ai"]');if(U){const $=U.querySelector("div.xdj266r.x14z9mp.xat24cr.x1lziwak.x1vvkbs"),V=U.querySelectorAll("div.x14z9mp.xat24cr.x1lziwak.x1vvkbs.xtlvy1s").length>0;if($||V){s=U,console.log("üìù [FOMO Bookmarklet] ‚úÖ Span trouv√© dans div parent html-div");break}}}if(s||(s=t.querySelector('span[dir="auto"][class*="xdmh292"][class*="x15dsfln"][class*="x140p0ai"]')),s){console.log("üìù [FOMO Bookmarklet] ‚úÖ Span multi-paragraphes trouv√©"),console.log("üìù [FOMO Bookmarklet] Contenu HTML du span (premiers 500 caract√®res):",s.innerHTML.substring(0,500));const H=s.cloneNode(!0),P=H.querySelectorAll('[role="button"], button, [class*="button"]');console.log("üìù [FOMO Bookmarklet] Nombre de boutons trouv√©s:",P.length);let X=0;P.forEach(e=>{const t=e.textContent.trim().toLowerCase();(t.includes("voir moins")||t.includes("voir plus")||t.includes("en savoir plus")||t.includes("see more")||t.includes("see less")||"voir plus"===t||"voir moins"===t||"plus"===t||"moins"===t||"more"===t||"less"===t)&&(e.remove(),X++)}),console.log("üìù [FOMO Bookmarklet] Boutons supprim√©s:",X);const G=e=>{const t=e.cloneNode(!0);return t.querySelectorAll("img[alt]").forEach(e=>{const t=e.getAttribute("alt")||"";if(e.parentNode){const o=document.createTextNode(t);try{e.parentNode.replaceChild(o,e)}catch(e){console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Erreur remplacement emoji:",e)}}}),t.querySelectorAll("br, br.html-br").forEach(e=>{if(e.parentNode){const t=document.createTextNode("\n");try{e.parentNode.replaceChild(t,e)}catch(e){console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Erreur remplacement <br>:",e)}}}),t.textContent.trim()},W=[],Y=H.querySelectorAll("div.xdj266r.x14z9mp.xat24cr.x1lziwak.x1vvkbs");if(console.log("üìù [FOMO Bookmarklet] Nombre de divs xdj266r trouv√©s:",Y.length),Y.length>0){const ee=Y[0],te=G(ee);console.log("üìù [FOMO Bookmarklet] Premier div (xdj266r) trouv√©"),console.log("üìù [FOMO Bookmarklet] Texte du premier div (avec emojis):",te),console.log("üìù [FOMO Bookmarklet] HTML du premier div (premiers 200 caract√®res):",ee.innerHTML.substring(0,200)),te&&te.length>0?(W.push(te),console.log("üìù [FOMO Bookmarklet] ‚úÖ Premier paragraphe ajout√© (longueur:",te.length,")")):console.warn("üìù [FOMO Bookmarklet] ‚ö†Ô∏è Premier div trouv√© mais texte vide apr√®s trim")}else console.log("üìù [FOMO Bookmarklet] ‚ö†Ô∏è Aucun div xdj266r trouv√©");const Z=H.querySelectorAll("div.x14z9mp.xat24cr.x1lziwak.x1vvkbs.xtlvy1s");if(console.log("üìù [FOMO Bookmarklet] Nombre de divs xtlvy1s trouv√©s:",Z.length),console.log("üìù [FOMO Bookmarklet] Extraction de tous les paragraphes dans l'ordre du DOM..."),Z.forEach((e,t)=>{const o=G(e);console.log(`üìù [FOMO Bookmarklet] Div xtlvy1s ${t+1}/${Z.length} texte complet (avec emojis):`,o),console.log(`üìù [FOMO Bookmarklet] Div xtlvy1s ${t+1} HTML (premiers 200 caract√®res):`,e.innerHTML.substring(0,200)),o&&o.length>0?(W.push(o),console.log(`üìù [FOMO Bookmarklet] ‚úÖ Paragraphe ${W.length} ajout√© (longueur: ${o.length})`)):console.warn(`üìù [FOMO Bookmarklet] ‚ö†Ô∏è Div xtlvy1s ${t+1} trouv√© mais texte vide apr√®s trim`)}),console.log("üìù [FOMO Bookmarklet] Total paragraphes extraits:",W.length),0===W.length){console.log("üìù [FOMO Bookmarklet] Aucun paragraphe structur√© trouv√©, recherche fallback dans tous les divs...");const oe=H.querySelectorAll("div.x14z9mp.xat24cr.x1lziwak.x1vvkbs");console.log("üìù [FOMO Bookmarklet] Nombre total de divs x14z9mp.xat24cr.x1lziwak.x1vvkbs trouv√©s:",oe.length),oe.forEach((e,t)=>{const o=G(e);o&&o.length>10&&(W.push(o),console.log(`üìù [FOMO Bookmarklet] ‚úÖ Paragraphe fallback ${W.length} ajout√© (avec emojis):`,o.substring(0,50)))})}let J="";W.length>0?(J=W.join("\n\n"),console.log("üìù [FOMO Bookmarklet] Total paragraphes concat√©n√©s:",W.length),console.log("üìù [FOMO Bookmarklet] Texte avant nettoyage (premiers 500 caract√®res):",J.substring(0,500))):(J=H.textContent.trim(),console.log("üìù [FOMO Bookmarklet] ‚ö†Ô∏è Aucun paragraphe structur√© trouv√©, utilisation du texte direct"),console.log("üìù [FOMO Bookmarklet] Texte direct (premiers 500 caract√®res):",J.substring(0,500)));const Q=J;J=J.replace(/\s*(voir\s+(plus|moins)|en\s+savoir\s+plus|see\s+(more|less))\s*/gi,""),J=J.replace(/\n{3,}/g,"\n\n").trim(),Q!==J&&console.log("üìù [FOMO Bookmarklet] Texte nettoy√© (diff√©rences d√©tect√©es)"),J&&J.length>20?(e.description=J.substring(0,2e3),console.log("‚úÖ [FOMO Bookmarklet] Description assign√©e √† data.description"),console.log("üìù [FOMO Bookmarklet] Longueur totale:",J.length),console.log("üìù [FOMO Bookmarklet] Description finale (premiers 500 caract√®res):",e.description.substring(0,500)),console.log("üìù [FOMO Bookmarklet] Description finale (derniers 200 caract√®res):",e.description.substring(Math.max(0,e.description.length-200)))):(console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Texte extrait trop court ou vide"),console.warn("üìù [FOMO Bookmarklet] Longueur du texte:",J?J.length:0),console.warn("üìù [FOMO Bookmarklet] Contenu du texte:",J))}else{console.log("‚ÑπÔ∏è [FOMO Bookmarklet] ‚ùå Span multi-paragraphes non trouv√©"),console.log("üìù [FOMO Bookmarklet] Recherche dans mainContent:",t?"trouv√©":"non trouv√©");const ne=t.querySelectorAll('span[dir="auto"]');console.log('üìù [FOMO Bookmarklet] Nombre total de spans dir="auto" trouv√©s:',ne.length)}if(console.log("üìù [FOMO Bookmarklet] === FIN EXTRACTION DESCRIPTION ==="),console.log("üìù [FOMO Bookmarklet] Description finale dans data.description:",e.description||"VIDE"),!e.description){const re=['[data-testid="event-permalink-details"]','[data-testid="event-permalink-description"]','[data-testid="event-permalink-about"]','[data-testid="event-permalink-event-description"]'];for(const se of re){const ae=document.querySelector(se);if(ae){const le=ae.textContent.trim();if(le&&le.length>20){e.description=le.substring(0,1e3);break}}}}if(!e.description){const ie=document.querySelector("div.xdj266r.x14z9mp.xat24cr.x1lziwak.x1vvkbs");if(ie){const ce=ie.cloneNode(!0);ce.querySelectorAll('[role="button"], button, [class*="button"]').forEach(e=>{const t=e.textContent.trim().toLowerCase();(t.includes("voir moins")||t.includes("voir plus")||t.includes("en savoir plus")||t.includes("see more")||t.includes("see less")||"voir plus"===t||"voir moins"===t||"plus"===t||"moins"===t||"more"===t||"less"===t)&&e.remove()});let de=ce.textContent.trim();de=de.replace(/\s*(voir\s+(plus|moins)|en\s+savoir\s+plus|see\s+(more|less))\s*/gi,""),de=de.replace(/\s+/g," ").trim(),de&&de.length>20&&(e.description=de.substring(0,1e3),console.log("üìù [FOMO Bookmarklet] Description trouv√©e via div sp√©cifique:",de.substring(0,100)))}}if(!e.description){const ue=t.querySelectorAll('div[class*="xdj266r"], div[class*="x14z9mp"]');for(const me of ue){const pe=me.cloneNode(!0);pe.querySelectorAll('[role="button"], button, [class*="button"]').forEach(e=>{const t=e.textContent.trim().toLowerCase();(t.includes("voir moins")||t.includes("voir plus")||t.includes("en savoir plus")||t.includes("see more")||t.includes("see less")||"voir plus"===t||"voir moins"===t||"plus"===t||"moins"===t||"more"===t||"less"===t)&&e.remove()});let ge=pe.textContent.trim();if(ge=ge.replace(/\s*(voir\s+(plus|moins)|en\s+savoir\s+plus|see\s+(more|less))\s*/gi,""),ge=ge.replace(/\s+/g," ").trim(),ge&&ge.length>50&&2e3>ge.length&&!ge.match(/^https?:\/\//)&&ge.split(/\s+/).length>10){e.description=ge.substring(0,1e3);break}}}if(!e.description){const ve=t.querySelectorAll('div[dir="auto"]');let ke="";for(const Oe of ve){const fe=Oe.cloneNode(!0);fe.querySelectorAll('[role="button"], button, [class*="button"]').forEach(e=>{const t=e.textContent.trim().toLowerCase();(t.includes("voir moins")||t.includes("voir plus")||t.includes("en savoir plus")||t.includes("see more")||t.includes("see less")||"voir plus"===t||"voir moins"===t||"plus"===t||"moins"===t||"more"===t||"less"===t)&&e.remove()});let he=fe.textContent.trim();he=he.replace(/\s*(voir\s+(plus|moins)|en\s+savoir\s+plus|see\s+(more|less))\s*/gi,""),he=he.replace(/\s+/g," ").trim(),he&&he.length>50&&2e3>he.length&&!he.match(/^https?:\/\//)&&he.split(/\s+/).length>10&&he.length>ke.length&&(ke=he)}ke&&(e.description=ke.substring(0,1e3))}console.log("üìÖ [FOMO Bookmarklet] === D√âBUT EXTRACTION DATES ===");let l=t.querySelector('span[dir="auto"][class*="xdmh292"][class*="x15dsfln"][class*="x140p0ai"][class*="x1yc453h"][class*="x1a1m0xk"][class*="x1xlr1w8"]')||t.querySelector('span[dir="auto"][class*="xdmh292"][class*="x15dsfln"][class*="x140p0ai"][class*="x1gufx9m"][class*="x1s928wv"][class*="x1yc453h"][class*="x1a1m0xk"][class*="x1xlr1w8"]')||t.querySelector('span[dir="auto"][class*="xdmh292"][class*="x15dsfln"][class*="x140p0ai"][class*="x1yc453h"]');if(!l){console.log("üìÖ [FOMO Bookmarklet] S√©lecteur sp√©cifique non trouv√©, recherche par couleur rouge (zone limit√©e)...");let xe=t;const be=document.querySelector('h1[data-testid="event-permalink-event-name"]')||t.querySelector("h1");if(be){let Me=be.parentElement,we=0;for(;Me&&5>we;){if(Array.from(Me.children).length>=3){xe=Me,console.log("üìÖ [FOMO Bookmarklet] Zone de recherche limit√©e au conteneur du titre");break}Me=Me.parentElement,we++}}const ye=xe.querySelectorAll('span[dir="auto"]');console.log("üìÖ [FOMO Bookmarklet] Nombre de spans √† analyser (zone limit√©e):",ye.length);for(const Ce of ye){const Fe=Ce.textContent.trim();if(Fe&&Fe.length>5&&100>Fe.length&&(/(?:lundi|mardi|mercredi|jeudi|vendredi|samedi|dimanche|monday|tuesday|wednesday|thursday|friday|saturday|sunday)\s+\d{1,2}\s+(janvier|f√©vrier|mars|avril|mai|juin|juillet|ao√ªt|septembre|octobre|novembre|d√©cembre|january|february|march|april|may|june|july|august|september|october|november|december)\s+\d{4}/i.test(Fe)||/du\s+\d{1,2}\s+(janv|f√©vr|mars|avr|mai|juin|juil|ao√ªt|sept|oct|nov|d√©c|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\.\s+\d{1,2}:\d{2}\s+au\s+\d{1,2}\s+(janv|f√©vr|mars|avr|mai|juin|juil|ao√ªt|sept|oct|nov|d√©c|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\.\s+\d{1,2}:\d{2}/i.test(Fe)||/(aujourd'hui|demain|today|tomorrow)\s+(de\s+\d{1,2}:\d{2}\s+√†\s+\d{1,2}:\d{2}|√†\s+\d{1,2}:\d{2})/i.test(Fe)||/(lundi|mardi|mercredi|jeudi|vendredi|samedi|dimanche|monday|tuesday|wednesday|thursday|friday|saturday|sunday)\s+(de\s+\d{1,2}:\d{2}\s+√†\s+\d{1,2}:\d{2}|√†\s+\d{1,2}:\d{2})/i.test(Fe))){const Be=window.getComputedStyle(Ce).color;let Ee=!1;const Se=Be.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);if(Se){const Ie=parseInt(Se[1]),Te=parseInt(Se[2]),Ae=parseInt(Se[3]);Ee=Ie>180&&120>Te&&120>Ae,Ee&&console.log("üìÖ [FOMO Bookmarklet] Date trouv√©e par couleur rouge:",Fe.substring(0,60),"RGB:",{r:Ie,g:Te,b:Ae})}else Ee=Be.includes("rgb(237, 65, 65)")||Be.includes("rgb(242, 61, 61)")||Be.includes("rgb(220, 29, 29)")||Be.includes("rgb(255, 0, 0)")||Be.includes("rgb(239, 68, 68)");if(Ee){l=Ce,console.log("‚úÖ [FOMO Bookmarklet] Date trouv√©e par couleur rouge:",Fe);break}}}}if(l){const _e=l.textContent.trim();console.log("üìÖ [FOMO Bookmarklet] Texte trouv√©:",_e);let Le=!1;try{let De=_e.match(/du\s+(\d{1,2})\s+(\w+)\.\s+(\d{1,2}):(\d{2})\s+au\s+(\d{1,2})\s+(\w+)\.\s+(\d{1,2}):(\d{2})/i);if(De){const[,Ne,qe,je,Re,Ke,ze,Ue,$e]=De;console.log("üìÖ [FOMO Bookmarklet] Match trouv√©:",{startDay:Ne,startMonthAbbr:qe,startHour:je,startMinute:Re,endDay:Ke,endMonthAbbr:ze,endHour:Ue,endMinute:$e});const Ve={janv:0,jan:0,"f√©vr":1,"f√©v":1,mars:2,mar:2,avr:3,mai:4,juin:5,juil:6,jul:6,"ao√ªt":7,aout:7,sept:8,oct:9,nov:10,"d√©c":11,dec:11,jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11},He=Ve[qe.toLowerCase()],Pe=Ve[ze.toLowerCase()];if(void 0!==He&&void 0!==Pe){const Xe=new Date;let Ge=Xe.getFullYear();(He<Xe.getMonth()||He===Xe.getMonth()&&parseInt(Ne)<Xe.getDate())&&(Ge+=1);const We=new Date(Ge,He,parseInt(Ne),parseInt(je),parseInt(Re)),Ye=new Date(Ge,Pe,parseInt(Ke),parseInt(Ue),parseInt($e));Ne===Ke&&He===Pe&&60*parseInt(je)+parseInt(Re)>60*parseInt(Ue)+parseInt($e)&&(Ye.setDate(Ye.getDate()+1),console.log("üìÖ [FOMO Bookmarklet] Heure de fin < heure de d√©but, √©v√©nement se termine le lendemain")),console.log("üìÖ [FOMO Bookmarklet] Dates cr√©√©es - D√©but:",We,"Fin:",Ye),isNaN(We.getTime())||isNaN(Ye.getTime())?console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Dates invalides apr√®s parsing"):(e.start=We.toISOString(),e.end=Ye.toISOString(),console.log("‚úÖ [FOMO Bookmarklet] Date d√©but extraite:",e.start),console.log("‚úÖ [FOMO Bookmarklet] Date fin extraite:",e.end)),Le=!0}else console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Mois non reconnus:",qe,ze)}if(!Le){let Ze=_e.match(/(?:lundi|mardi|mercredi|jeudi|vendredi|samedi|dimanche|monday|tuesday|wednesday|thursday|friday|saturday|sunday)\s+(\d{1,2})\s+(\w+)\s+(\d{4})\s+de\s+(\d{1,2}):(\d{2})\s+√†\s+(\d{1,2}):(\d{2})/i);if(Ze){const[,Je,Qe,et,tt,ot,nt,rt]=Ze,st={janvier:0,"f√©vrier":1,mars:2,avril:3,mai:4,juin:5,juillet:6,"ao√ªt":7,septembre:8,octobre:9,novembre:10,"d√©cembre":11,january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11}[Qe.toLowerCase()];if(void 0!==st){const at=new Date(parseInt(et),st,parseInt(Je),parseInt(tt),parseInt(ot)),lt=new Date(parseInt(et),st,parseInt(Je),parseInt(nt),parseInt(rt));60*parseInt(tt)+parseInt(ot)>60*parseInt(nt)+parseInt(rt)&&lt.setDate(lt.getDate()+1),isNaN(at.getTime())||isNaN(lt.getTime())||(e.start=at.toISOString(),e.end=lt.toISOString(),Le=!0)}}else if(Ze=_e.match(/(?:lundi|mardi|mercredi|jeudi|vendredi|samedi|dimanche|monday|tuesday|wednesday|thursday|friday|saturday|sunday)\s+(\d{1,2})\s+(\w+)\s+(\d{4})\s+√†\s+(\d{1,2}):(\d{2})/i),Ze){const[,it,ct,dt,ut,mt]=Ze,pt={janvier:0,"f√©vrier":1,mars:2,avril:3,mai:4,juin:5,juillet:6,"ao√ªt":7,septembre:8,octobre:9,novembre:10,"d√©cembre":11,january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11}[ct.toLowerCase()];if(void 0!==pt){const gt=new Date(parseInt(dt),pt,parseInt(it),parseInt(ut),parseInt(mt));isNaN(gt.getTime())||(e.start=gt.toISOString(),Le=!0)}}}if(!Le){const vt=_e.match(/(lundi|mardi|mercredi|jeudi|vendredi|samedi|dimanche|monday|tuesday|wednesday|thursday|friday|saturday|sunday)(?:\s+de\s+(\d{1,2}):(\d{2})\s+√†\s+(\d{1,2}):(\d{2})|\s+√†\s+(\d{1,2}):(\d{2}))/i);if(vt){const[,kt,Ot,ft,ht,xt,bt,yt]=vt,Mt={dimanche:0,sunday:0,lundi:1,monday:1,mardi:2,tuesday:2,mercredi:3,wednesday:3,jeudi:4,thursday:4,vendredi:5,friday:5,samedi:6,saturday:6}[kt.toLowerCase()];if(null!==Mt){const wt=new Date;let Ct=Mt-wt.getDay();Ct>0||(Ct+=7);const Ft=new Date(wt);if(Ft.setDate(wt.getDate()+Ct),void 0!==Ot){Ft.setHours(parseInt(Ot),parseInt(ft),0,0),e.start=Ft.toISOString();const Bt=new Date(Ft);Bt.setHours(parseInt(ht),parseInt(xt),0,0),60*parseInt(Ot)+parseInt(ft)>60*parseInt(ht)+parseInt(xt)&&Bt.setDate(Bt.getDate()+1),e.end=Bt.toISOString()}else Ft.setHours(parseInt(bt),parseInt(yt),0,0),e.start=Ft.toISOString();Le=!0}}}if(!Le&&(/(aujourd'hui|today)/i.test(_e)||/(demain|tomorrow)/i.test(_e))){let Et=new Date(new Date);/(demain|tomorrow)/i.test(_e)&&Et.setDate(Et.getDate()+1);const St=_e.match(/de\s+(\d{1,2}):(\d{2})\s+√†\s+(\d{1,2}):(\d{2})/i);if(St){const[,It,Tt,At,_t]=St;Et.setHours(parseInt(It),parseInt(Tt),0,0),e.start=Et.toISOString();const Lt=new Date(Et);Lt.setHours(parseInt(At),parseInt(_t),0,0),60*parseInt(It)+parseInt(Tt)>60*parseInt(At)+parseInt(_t)&&Lt.setDate(Lt.getDate()+1),e.end=Lt.toISOString()}else{const Dt=_e.match(/√†\s+(\d{1,2}):(\d{2})/i);if(Dt){const[,Nt,qt]=Dt;Et.setHours(parseInt(Nt),parseInt(qt),0,0),e.start=Et.toISOString()}}Le=!0}Le||(e.start=_e,console.log("üìÖ [FOMO Bookmarklet] Aucun pattern reconnu, texte brut conserv√©:",_e))}catch(jt){console.error("‚ùå [FOMO Bookmarklet] Erreur parsing date:",jt),e.start=_e}}else console.log("üìÖ [FOMO Bookmarklet] Span sp√©cifique non trouv√©");console.log("üìÖ [FOMO Bookmarklet] === R√âSUM√â EXTRACTION DATES ==="),console.log("üìÖ [FOMO Bookmarklet] Date d√©but:",e.start||"NON TROUV√âE"),console.log("üìÖ [FOMO Bookmarklet] Date fin:",e.end||"NON TROUV√âE"),console.log("üìÖ [FOMO Bookmarklet] === FIN EXTRACTION DATES ==="),console.log("üìç [FOMO Bookmarklet] === D√âBUT EXTRACTION ADRESSE ===");let i=null;const c=document.querySelector('h1[data-testid="event-permalink-event-name"]')||t.querySelector("h1");if(c){let Rt=c.parentElement,Kt=0;for(;Rt&&10>Kt;){const zt=Rt.querySelector('span[dir="auto"][class*="xdmh292"][class*="x15dsfln"][class*="x140p0ai"]'),Ut=Rt.querySelector('span[dir="auto"][class*="xdmh292"][class*="x15dsfln"][class*="x1yc453h"]');if(zt||Ut){i=Rt,console.log("üìç [FOMO Bookmarklet] Conteneur √©v√©nement trouv√©");break}Rt=Rt.parentElement,Kt++}}const d=i;d?console.log("üìç [FOMO Bookmarklet] Zone de recherche: conteneur √©v√©nement"):console.warn("üìç [FOMO Bookmarklet] ‚ö†Ô∏è Conteneur √©v√©nement non trouv√© - recherche d'adresse d√©sactiv√©e pour √©viter les faux positifs");const u=d||t;if(!e.venue_name||!e.address){console.log("üìç [FOMO Bookmarklet] Strat√©gie 0: Recherche via aria-label de localisation...");const $t=u.querySelector('div[aria-label*="Informations de localisation"], div[aria-label*="localisation"]');if($t){console.log("‚úÖ [FOMO Bookmarklet] Div de localisation trouv√© via aria-label");const Vt=$t.querySelector('a[role="link"]');if(Vt){console.log("‚úÖ [FOMO Bookmarklet] Lien trouv√© dans le div de localisation");const Ht=Vt.querySelectorAll('span[dir="auto"]'),Pt=[];for(const Gt of Ht){const Wt=Gt.textContent.trim();Wt&&Wt.length>2&&200>Wt.length&&!Pt.includes(Wt)&&Pt.push(Wt)}const Xt=Vt.querySelectorAll("div.xu06os2.x1ok221b");if(Xt.length>=2){const Yt=Xt[0],Zt=Xt[1],Jt=Yt.textContent.trim(),Qt=Zt.textContent.trim();Jt&&Jt.length>2&&200>Jt.length&&Qt&&Qt.length>5&&200>Qt.length&&(e.title&&(Jt.toLowerCase()===e.title.toLowerCase()||Jt.toLowerCase().includes(e.title.toLowerCase())||e.title.toLowerCase().includes(Jt.toLowerCase()))||(Qt.includes(",")||/(rue|avenue|boulevard|place|chemin|route|all√©e|impasse|street|road|way|drive|france|belgium|belgique)/i.test(Qt))&&(e.venue_name||(e.venue_name=Jt,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu trouv√© via lien (divs):",Jt)),e.address||(e.address=Qt,console.log("‚úÖ [FOMO Bookmarklet] Adresse trouv√©e via lien (divs):",Qt))))}if(e.venue_name&&e.address||2>Pt.length){if(1===Pt.length&&!e.address){const eo=Pt[0];(eo.includes(",")||/(rue|avenue|boulevard|place|chemin|route|all√©e|impasse|street|road|way|drive|france|belgium|belgique)/i.test(eo))&&(e.address=eo,console.log("‚úÖ [FOMO Bookmarklet] Adresse trouv√©e via lien (texte unique):",eo))}}else{const to=Pt[0],oo=Pt[1];e.title&&(to.toLowerCase()===e.title.toLowerCase()||to.toLowerCase().includes(e.title.toLowerCase())||e.title.toLowerCase().includes(to.toLowerCase()))||(oo.includes(",")||/(rue|avenue|boulevard|place|chemin|route|all√©e|impasse|street|road|way|drive|france|belgium|belgique)/i.test(oo))&&(e.venue_name||(e.venue_name=to,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu trouv√© via lien (spans):",to)),e.address||(e.address=oo,console.log("‚úÖ [FOMO Bookmarklet] Adresse trouv√©e via lien (spans):",oo)))}}else console.log("‚ö†Ô∏è [FOMO Bookmarklet] Lien non trouv√© dans le div de localisation")}else{console.log("‚ö†Ô∏è [FOMO Bookmarklet] Div de localisation non trouv√© via aria-label, fallback sur recherche de liens...");const no=u.querySelectorAll('a[role="link"]');console.log("üìç [FOMO Bookmarklet] Nombre de liens trouv√©s (fallback):",no.length);for(const ro of no){const so=ro.className;if(!so.includes("x1i10hfl")||!so.includes("x1qjc9v5"))continue;const ao=ro.querySelectorAll('span[dir="auto"]'),lo=[];for(const co of ao){const uo=co.textContent.trim();uo&&uo.length>2&&200>uo.length&&!lo.includes(uo)&&lo.push(uo)}const io=ro.querySelectorAll("div.xu06os2.x1ok221b");if(io.length>=2){const mo=io[0],po=io[1],go=mo.textContent.trim(),vo=po.textContent.trim();if(go&&go.length>2&&200>go.length&&vo&&vo.length>5&&200>vo.length&&(!e.title||go.toLowerCase()!==e.title.toLowerCase()&&!go.toLowerCase().includes(e.title.toLowerCase())&&!e.title.toLowerCase().includes(go.toLowerCase()))&&(vo.includes(",")||/(rue|avenue|boulevard|place|chemin|route|all√©e|impasse|street|road|way|drive|france|belgium|belgique)/i.test(vo))){e.venue_name||(e.venue_name=go,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu trouv√© via lien (fallback divs):",go)),e.address||(e.address=vo,console.log("‚úÖ [FOMO Bookmarklet] Adresse trouv√©e via lien (fallback divs):",vo));break}}if(!(e.venue_name&&e.address||2>lo.length)){const ko=lo[0],Oo=lo[1];if((!e.title||ko.toLowerCase()!==e.title.toLowerCase()&&!ko.toLowerCase().includes(e.title.toLowerCase())&&!e.title.toLowerCase().includes(ko.toLowerCase()))&&(Oo.includes(",")||/(rue|avenue|boulevard|place|chemin|route|all√©e|impasse|street|road|way|drive|france|belgium|belgique)/i.test(Oo))){e.venue_name||(e.venue_name=ko,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu trouv√© via lien (fallback spans):",ko)),e.address||(e.address=Oo,console.log("‚úÖ [FOMO Bookmarklet] Adresse trouv√©e via lien (fallback spans):",Oo));break}}}}}if(!e.venue_name&&u){console.log("üìç [FOMO Bookmarklet] Strat√©gie SVG: Recherche via ic√¥ne de localisation...");const fo=u.querySelectorAll("svg");console.log("üìç [FOMO Bookmarklet] Nombre de SVG trouv√©s:",fo.length);for(const ho of fo){const xo=ho.querySelectorAll("path");let bo=!1;for(const yo of xo){const Mo=yo.getAttribute("d");if(Mo&&Mo.includes("M10 .5A7.5 7.5 0 0 0 2.5 8")){bo=!0,console.log("üìç [FOMO Bookmarklet] Ic√¥ne de localisation trouv√©e");break}}if(bo){let wo=ho.parentElement,Co=0;const Fo=5;for(;wo&&Fo>Co;){const Bo=wo.querySelectorAll('span, div[role="button"], a, p');for(const Eo of Bo){const So=Eo.textContent.trim();if(So&&So.length>=2&&200>=So.length&&(!e.title||So.toLowerCase()!==e.title.toLowerCase()&&!So.toLowerCase().includes(e.title.toLowerCase())&&!e.title.toLowerCase().includes(So.toLowerCase()))){if(!So.includes(",")){e.venue_name=So,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu trouv√© (nom simple):",So);break}{const Io=So.split(",").map(e=>e.trim());if(Io.length>=2){const To=Io[Io.length-2];if(To&&To.length>=2&&100>To.length){e.venue_name=To,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu extrait de l'adresse (ville):",To),console.log("üìç [FOMO Bookmarklet] Adresse compl√®te trouv√©e:",So),e.address||(e.address=So);break}}}}}if(e.venue_name)break;wo=wo.parentElement,Co++}if(e.venue_name)break}}}console.log("üìç [FOMO Bookmarklet] Nom du lieu final:",e.venue_name||"NON TROUV√â"),console.log("üìç [FOMO Bookmarklet] === FIN EXTRACTION ADRESSE ==="),!e.address&&e.venue_name&&(e.address=e.venue_name,console.log("üìç [FOMO Bookmarklet] Adresse non trouv√©e, utilisation du nom du lieu comme adresse:",e.address)),console.log("üìç [FOMO Bookmarklet] Adresse finale:",e.address||"NON TROUV√âE"),console.log("üë§ [FOMO Bookmarklet] === D√âBUT EXTRACTION ORGANISATEUR ===");const m=t.querySelectorAll("span");for(const Ao of m){const _o=Ao.textContent.trim();if(_o&&(_o.toLowerCase().includes("√©v√®nement de")||_o.toLowerCase().includes("event by")||_o.toLowerCase().includes("√©v√©nement de"))){const Lo=Ao.querySelectorAll("a"),Do=[];for(const No of Lo){const qo=No.textContent.trim();qo&&qo.length>0&&Do.push(qo)}if(Do.length>0){e.host=Do.join(" et "),console.log("üë§ [FOMO Bookmarklet] ‚úÖ Organisateur(s) trouv√©(s):",e.host);break}}}console.log("üë§ [FOMO Bookmarklet] === FIN EXTRACTION ORGANISATEUR ==="),console.log("üë§ [FOMO Bookmarklet] Organisateur final:",e.host||"NON TROUV√â");const p=['img[data-imgperflogname="profileCoverPhoto"]','img[data-testid="event-cover-photo"]','img[alt*="cover"]','img[alt*="Cover"]','img[alt*="event cover"]'];for(const jo of p){const Ro=document.querySelector(jo);if(Ro&&Ro.src&&!Ro.src.includes("data:image")){if("profileCoverPhoto"===Ro.getAttribute("data-imgperflogname")){e.cover=Ro.src,console.log("üñºÔ∏è [FOMO Bookmarklet] Image de couverture trouv√©e via profileCoverPhoto:",Ro.src.substring(0,100));break}if(Ro.offsetWidth>400||Ro.naturalWidth>400){e.cover=Ro.src;break}}}if(!e.cover){const Ko=t.querySelectorAll("img");let zo=null,Uo=0;for(const $o of Ko)if($o.src&&!$o.src.includes("data:image")&&!$o.src.includes("profile")&&!$o.src.includes("avatar")&&!$o.src.includes("icon")&&(!$o.alt||!$o.alt.toLowerCase().includes("profile"))){const Vo=$o.getBoundingClientRect(),Ho=($o.offsetWidth||$o.naturalWidth||Vo.width)*($o.offsetHeight||$o.naturalHeight||Vo.height),Po=Vo.top,Xo=Ho/100+(1e3>Po?(1e3-Po)/10:0)+($o.src.includes("scontent")?100:0);Ho>5e4&&2e3>Po&&Xo>Uo&&(Uo=Xo,zo=$o)}if(zo){let Go=zo.src;Go.includes("scontent")&&Go.includes("&")&&(Go=Go.split("&")[0]+"&ext="),e.cover=Go}}function g(e){if(!e)return null;let t=e.replace(/\u00A0/g," ").trim().replace(/\s+/g," ");if(/^\d+$/.test(t))return t;const o=t.match(/^(\d+)[,.]?(\d+)?\s*K$/i);if(o){const[,e,t]=o;return t?`${e}.${t}K`.toUpperCase():(e+"K").toUpperCase()}const n=t.match(/^(\d+)[,.]?(\d+)?\s*M$/i);if(n){const[,e,t]=n;return t?`${e}.${t}M`.toUpperCase():(e+"M").toUpperCase()}return null}const v=t.querySelectorAll('span[dir="auto"][class*="xdmh292"], span[dir="auto"][class*="x15dsfln"]');for(const Wo of v){let Yo=Wo.textContent.trim(),Zo=g(Yo);if(null===Zo&&Wo.parentElement){const Jo=Wo.parentElement.textContent.trim();Zo=g(Jo),null!==Zo&&(Yo=Jo)}if(null!==Zo){const Qo=Wo.parentElement,en=Qo?Qo.parentElement:null;let tn=[];if(Qo&&tn.push(Qo.textContent.trim().toLowerCase()),en&&tn.push(en.textContent.trim().toLowerCase()),Qo){const nn=Wo.previousElementSibling,rn=Wo.nextElementSibling;nn&&tn.push(nn.textContent.trim().toLowerCase()),rn&&tn.push(rn.textContent.trim().toLowerCase())}Qo&&Array.from(Qo.parentElement?Qo.parentElement.children:[]).forEach(e=>{e!==Qo&&tn.push(e.textContent.trim().toLowerCase())});const on=tn.join(" ");(on.includes("participant")||on.includes("going")||on.includes("vont")||on.includes("participer")||on.includes("personne")||on.includes("va"))&&(e.attending_count||(e.attending_count=Zo,console.log("üë• [FOMO Bookmarklet] Participants trouv√©s via span:",Zo))),(on.includes("int√©ress√©")||on.includes("interested")||on.includes("s'int√©resse"))&&(e.interested_count||(e.interested_count=Zo,console.log("üëÄ [FOMO Bookmarklet] Int√©ress√©s trouv√©s via span:",Zo)))}}const k=document.body.textContent||"",O=[/(\d+(?:[.,]\d+)?\s*[KM]?)\s*(personnes|people|participants|going|participent|vont|participeront)/i,/(\d+(?:[.,]\d+)?\s*[KM]?)\s*(personne|person|participant|va|participera)/i,/going[:\s]+(\d+(?:[.,]\d+)?\s*[KM]?)/i,/participants[:\s]+(\d+(?:[.,]\d+)?\s*[KM]?)/i];for(const sn of O){const an=k.match(sn);if(an){const ln=g(an[1].trim());null===ln||e.attending_count||(e.attending_count=ln);break}}const f=[/(\d+(?:[.,]\d+)?\s*[KM]?)\s*(int√©ress√©s|interested|int√©ress√©es|s'int√©ressent)/i,/(\d+(?:[.,]\d+)?\s*[KM]?)\s*(int√©ress√©|interested)/i,/interested[:\s]+(\d+(?:[.,]\d+)?\s*[KM]?)/i,/int√©ress√©s[:\s]+(\d+(?:[.,]\d+)?\s*[KM]?)/i];for(const cn of f){const dn=k.match(cn);if(dn){const un=g(dn[1].trim());null===un||e.interested_count||(e.interested_count=un);break}}const h=document.querySelectorAll('button, [role="button"]');for(const mn of h){const pn=mn.textContent.trim(),gn=pn.match(/(\d+(?:[.,]\d+)?\s*[KM]?)\s*(going|participants|vont)/i);if(gn){const kn=g(gn[1].trim());null===kn||e.attending_count||(e.attending_count=kn)}const vn=pn.match(/(\d+(?:[.,]\d+)?\s*[KM]?)\s*(interested|int√©ress√©s)/i);if(vn){const On=g(vn[1].trim());null===On||e.interested_count||(e.interested_count=On)}}}catch(fn){console.error("Erreur extraction donn√©es:",fn)}return console.log("üîç [FOMO Bookmarklet] Donn√©es extraites:",e),console.log("üîç [FOMO Bookmarklet] Champs remplis:",{title:!!e.title,description:!!e.description,start:!!e.start,end:!!e.end,venue_name:!!e.venue_name,address:!!e.address,host:!!e.host,cover:!!e.cover,attending_count:e.attending_count,interested_count:e.interested_count}),e}(),0,()=>{window.__FOMO_BOOKMARKLET_ACTIVE=!1})}catch(e){alert("Erreur: "+e.message),window.__FOMO_BOOKMARKLET_ACTIVE=!1}}()):alert("‚ö†Ô∏è Ce bookmarklet doit √™tre utilis√© sur une page d'√©v√©nement Facebook.\n\nOuvrez une page d'√©v√©nement Facebook (ex: facebook.com/events/...) puis r√©essayez.")}();