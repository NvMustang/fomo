!function(){"use strict";window.location.href.includes("/events/")&&window.location.hostname.includes("facebook.com")?window.__FOMO_BOOKMARKLET_ACTIVE||(window.__FOMO_BOOKMARKLET_ACTIVE=!0,async function(){try{!function(e,t,o){const n=document.createElement("div");n.id="fomo-bookmarklet-modal",n.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            width: 400px;\n            max-height: calc(100vh - 40px);\n            background: white;\n            border-radius: 8px;\n            padding: 20px;\n            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n            z-index: 999999;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            display: flex;\n            flex-direction: column;\n            overflow: hidden;\n        ";const r=document.createElement("div");r.style.cssText="\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 16px;\n            flex-shrink: 0;\n            cursor: move;\n            user-select: none;\n        ";const s=document.createElement("h2");s.textContent="üìÖ Ajouter l'√©v√©nement √† FOMO",s.style.cssText="margin: 0; font-size: 18px; color: #333; flex: 1;";const l=document.createElement("button");l.type="button",l.innerHTML="√ó",l.style.cssText="\n            background: none;\n            border: none;\n            font-size: 28px;\n            color: #666;\n            cursor: pointer;\n            padding: 0;\n            width: 30px;\n            height: 30px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            line-height: 1;\n            border-radius: 4px;\n        ",l.onclick=()=>{document.body.contains(n)&&document.body.removeChild(n),window.__FOMO_BOOKMARKLET_ACTIVE=!1,o()},l.onmouseover=()=>{l.style.background="#f0f0f0"},l.onmouseout=()=>{l.style.background="none"},r.appendChild(s),r.appendChild(l);let a=!1,i=0,c=0,d=0,u=0;r.onmousedown=e=>{if("BUTTON"===e.target.tagName||e.target.closest("button"))return;a=!0,i=e.clientX,c=e.clientY;const t=n.getBoundingClientRect();d=t.left,u=t.top,n.style.transition="none",document.body.style.userSelect="none"},document.addEventListener("mousemove",e=>{if(!a)return;e.preventDefault();const t=e.clientX-i,o=e.clientY-c;let r=d+t,s=u+o;const l=window.innerWidth-n.offsetWidth,m=window.innerHeight-n.offsetHeight;r=Math.max(0,Math.min(r,l)),s=Math.max(0,Math.min(s,m)),n.style.left=r+"px",n.style.top=s+"px",n.style.right="auto",n.style.bottom="auto"}),document.addEventListener("mouseup",()=>{a&&(a=!1,n.style.transition="",document.body.style.userSelect="")});const m=document.createElement("div");m.style.cssText="\n            overflow-y: auto;\n            overflow-x: hidden;\n            flex: 1;\n            padding-right: 8px;\n        ";const p=document.createElement("form");function k(e,t,o,n=!1,r="text"){const s=document.createElement("div");s.style.cssText="display: flex; flex-direction: column; gap: 4px;";const l=document.createElement("label");let a;return l.textContent=e+(n?" *":""),l.style.cssText="font-weight: 600; color: #555; font-size: 14px;","textarea"===r?(a=document.createElement("textarea"),a.rows=4):(a=document.createElement("input"),a.type=r),a.name=t,"number"===r?(a.value=null!=o?o+"":"0",a.min="0"):a.value=o||"",a.required=n,a.style.cssText="\n                padding: 6px 10px;\n                border: 1px solid #ddd;\n                border-radius: 4px;\n                font-size: 13px;\n                font-family: inherit;\n                width: 100%;\n                box-sizing: border-box;\n            ",s.appendChild(l),s.appendChild(a),{container:s,input:a}}p.style.cssText="display: flex; flex-direction: column; gap: 12px;";const O=k("URL","url",e.url,!0);O.input.readOnly=!0,O.input.style.background="#f5f5f5";const g=k("Titre","title",e.title,!0),v=k("Description","description",e.description,!0,"textarea");let f="",h="";if(e.start)try{console.log("üìÖ [FOMO Bookmarklet] Date d√©but ISO re√ßue:",e.start);const t=new Date(e.start);if(isNaN(t.getTime()))console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Date d√©but invalide:",e.start);else{const e=t.getFullYear();f=`${e}-${(t.getMonth()+1+"").padStart(2,"0")}-${(t.getDate()+"").padStart(2,"0")}T${(t.getHours()+"").padStart(2,"0")}:${(t.getMinutes()+"").padStart(2,"0")}`,console.log("üìÖ [FOMO Bookmarklet] Date d√©but convertie pour datetime-local:",f)}}catch(t){console.error("‚ùå [FOMO Bookmarklet] Erreur conversion date d√©but:",t,e.start)}else console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Pas de date d√©but dans eventData");if(e.end)try{console.log("üìÖ [FOMO Bookmarklet] Date fin ISO re√ßue:",e.end);const t=new Date(e.end);if(isNaN(t.getTime()))console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Date fin invalide:",e.end);else{const e=t.getFullYear();h=`${e}-${(t.getMonth()+1+"").padStart(2,"0")}-${(t.getDate()+"").padStart(2,"0")}T${(t.getHours()+"").padStart(2,"0")}:${(t.getMinutes()+"").padStart(2,"0")}`,console.log("üìÖ [FOMO Bookmarklet] Date fin convertie pour datetime-local:",h)}}catch(t){console.error("‚ùå [FOMO Bookmarklet] Erreur conversion date fin:",t,e.end)}const M=k("Date de d√©but (ISO)","start",f||e.start,!0,"datetime-local"),x=k("Date de fin (ISO)","end",h||e.end,!1,"datetime-local"),b=k("Nom du lieu","venue_name",e.venue_name,!1),F=k("Adresse du lieu","address",e.address,!0),B=k("Organisateur","host",e.host,!1),y=k("Image de couverture (URL)","cover",e.cover,!0),w=k("Nombre de participants","attending_count",e.attending_count||"",!1,"text"),C=k("Nombre d'int√©ress√©s","interested_count",e.interested_count||"",!1,"text");console.log("üìÖ [FOMO Bookmarklet] Valeur finale champ date d√©but:",M.input.value),console.log("üìÖ [FOMO Bookmarklet] Valeur finale champ date fin:",x.input.value),p.appendChild(O.container),p.appendChild(g.container),p.appendChild(v.container),p.appendChild(M.container),p.appendChild(x.container),p.appendChild(b.container),p.appendChild(F.container),p.appendChild(B.container),p.appendChild(y.container),p.appendChild(w.container),p.appendChild(C.container),m.appendChild(r),m.appendChild(p);const S=document.createElement("div");S.style.cssText="display: flex; gap: 12px; justify-content: flex-end; margin-top: 16px; padding-top: 16px; border-top: 1px solid #eee; flex-shrink: 0;";const E=document.createElement("button");E.type="button",E.textContent="Annuler",E.style.cssText="\n            padding: 8px 16px;\n            border: 1px solid #ccc;\n            background: #f5f5f5;\n            color: #333;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n            min-width: 80px;\n            flex-shrink: 0;\n        ",E.onclick=()=>{document.body.contains(n)&&document.body.removeChild(n),window.__FOMO_BOOKMARKLET_ACTIVE=!1,o()};const D=document.createElement("button");D.type="button",D.textContent="Envoyer",D.style.cssText="\n            padding: 8px 16px;\n            border: none;\n            background: #1877f2;\n            color: white;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 600;\n            min-width: 80px;\n            flex-shrink: 0;\n        ",D.onclick=()=>{console.log("üîò [FOMO Bookmarklet] Bouton Envoyer cliqu√©");const e=new Event("submit",{bubbles:!0,cancelable:!0});p.dispatchEvent(e)},S.appendChild(E),S.appendChild(D),p.onsubmit=async e=>{if(e.preventDefault(),console.log("üîò [FOMO Bookmarklet] Formulaire soumis"),!g.input.value.trim())return void alert("Le titre est obligatoire");if(!v.input.value.trim())return void alert("La description est obligatoire");if(!M.input.value.trim())return void alert("La date de d√©but est obligatoire");if(!F.input.value.trim())return void alert("L'adresse est obligatoire (n√©cessaire pour le g√©ocodage)");if(!y.input.value.trim())return void alert("L'image de couverture est obligatoire");let t=M.input.value;if("datetime-local"===M.input.type)try{const e=new Date(M.input.value);isNaN(e.getTime())||(t=e.toISOString())}catch(e){return void alert("Format de date invalide")}let o=x.input.value;if(x.input.value&&"datetime-local"===x.input.type)try{const e=new Date(x.input.value);isNaN(e.getTime())||(o=e.toISOString())}catch(e){o=""}const n={source:"facebook",url:O.input.value.trim(),title:g.input.value.trim(),description:v.input.value.trim(),start:t,address:F.input.value.trim(),cover:y.input.value.trim()};o&&o.trim()&&(n.end=o);const r=b.input.value.trim();r&&(n.venue_name=r);const s=B.input.value.trim();s&&(n.host=s);const l=w.input.value.trim();l&&(n.attending_count=l);const a=C.input.value.trim();a&&(n.interested_count=a),D.disabled=!0,D.textContent="Envoi...",console.log("üì§ [FOMO Bookmarklet] Envoi du payload:",n);try{await(async e=>{console.log("üöÄ [FOMO Bookmarklet] Callback onConfirm appel√© avec payload:",e);try{const t=await function(e,t){return console.log("üì§ [FOMO Bookmarklet] Envoi des donn√©es via formulaire POST..."),new Promise((o,n)=>{const r="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():`req_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,s=window.location.origin,l=document.createElement("form");l.method="POST",l.action="https://fomo-swart.vercel.app/api/ingest/event-form",l.target="fomo-bookmarklet-receiver",l.style.cssText="position: absolute; left: -9999px; opacity: 0; pointer-events: none;";const a=document.createElement("input");a.type="hidden",a.name="apiKey",a.value=t,l.appendChild(a);const i=document.createElement("input");i.type="hidden",i.name="requestId",i.value=r,l.appendChild(i);const c=document.createElement("input");c.type="hidden",c.name="expectedOrigin",c.value=s,l.appendChild(c);for(const[t,o]of Object.entries(e))if(null!=o){const e=document.createElement("input");e.type="hidden",e.name=t,e.value="string"==typeof o?o:JSON.stringify(o),l.appendChild(e)}document.body.appendChild(l);let d=null;const u=e=>{console.log("üì® [FOMO Bookmarklet] Message re√ßu:",{origin:e.origin,type:e.data?.type,requestId:e.data?.requestId,expectedRequestId:r});const t=["https://fomo-swart.vercel.app"];if(t.some(t=>{const o=t.replace("https://","").replace("http://","").split(":")[0];return e.origin.includes(o)})){if("FOMO_INGEST_RESPONSE"===e.data?.type&&e.data?.requestId===r){console.log("‚úÖ [FOMO Bookmarklet] R√©ponse re√ßue:",e.data),d&&clearTimeout(d),window.removeEventListener("message",u),document.body.contains(l)&&document.body.removeChild(l);try{const e=window.open("","fomo-bookmarklet-receiver");e&&!e.closed&&e.close()}catch(e){}e.data.ok?o({ok:!0,id:e.data.id,duplicate:e.data.duplicate||!1}):n(Error(e.data.error||"Erreur inconnue"))}}else console.log("‚ö†Ô∏è [FOMO Bookmarklet] Message ignor√© - origine incorrecte:",e.origin,"attendu:",t)};window.addEventListener("message",u),console.log("üì§ [FOMO Bookmarklet] Soumission du formulaire POST..."),console.log("üì§ [FOMO Bookmarklet] RequestId:",r),console.log("üì§ [FOMO Bookmarklet] ExpectedOrigin:",s),l.submit(),setTimeout(()=>{try{const e=window.open("","fomo-bookmarklet-receiver");e&&!e.closed?console.log("‚úÖ [FOMO Bookmarklet] Popup ouverte avec succ√®s"):console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Popup non accessible ou ferm√©e")}catch(e){console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Impossible de v√©rifier la popup:",e)}},500),d=setTimeout(()=>{console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Timeout apr√®s 10 secondes - pas de r√©ponse du serveur"),window.removeEventListener("message",u),document.body.contains(l)&&document.body.removeChild(l),n(Error("Timeout - la popup n'a pas r√©pondu. V√©rifiez que les popups ne sont pas bloqu√©es."))},1e4)})}(e,"LaFomoCrew");console.log("‚úÖ [FOMO Bookmarklet] √âv√©nement cr√©√©:",t),t.ok?t.duplicate?alert("‚ö†Ô∏è Doublon d√©tect√©. L'√©v√©nement existe d√©j√† ‚úÖ\nID: "+t.id):alert("√âv√©nement envoy√© ‚úÖ\nID: "+t.id):alert("‚ùå Erreur: "+(t.error||"Erreur inconnue"));const o=document.querySelector("#fomo-bookmarklet-modal");o&&document.body.contains(o)&&document.body.removeChild(o),window.__FOMO_BOOKMARKLET_ACTIVE=!1}catch(e){console.error("‚ùå [FOMO Bookmarklet] Erreur dans callback onConfirm:",e);const t=document.querySelector("#fomo-bookmarklet-modal");if(t){const o=t.querySelector("div");if(o){const t=document.createElement("div");t.style.cssText="\n                                padding: 12px;\n                                margin-top: 12px;\n                                border-radius: 4px;\n                                background: #f8d7da;\n                                color: #721c24;\n                                font-size: 14px;\n                                text-align: center;\n                            ",t.textContent="‚ùå Erreur: "+(e.message||"Erreur inconnue"),o.appendChild(t)}}if(t){const e=t.querySelectorAll('button[type="button"]');for(const t of e)if("Envoi..."===t.textContent.trim()||"Envoyer"===t.textContent.trim()){t.disabled=!1,t.textContent="Envoyer";break}}}})(n),console.log("‚úÖ [FOMO Bookmarklet] onConfirm termin√© avec succ√®s")}catch(e){console.error("‚ùå [FOMO Bookmarklet] Erreur dans onConfirm:",e),D.disabled=!1,D.textContent="Envoyer",alert("Erreur: "+(e.message||"Erreur inconnue"))}},n.appendChild(m),n.appendChild(S);const T=e=>{"Escape"===e.key&&(document.body.contains(n)&&document.body.removeChild(n),window.__FOMO_BOOKMARKLET_ACTIVE=!1,document.removeEventListener("keydown",T),o())};document.addEventListener("keydown",T),document.body.appendChild(n)}(await async function(){const e={source:"facebook",url:window.location.href,title:"",description:"",start:"",end:"",timezone:"Europe/Brussels",venue_name:"",address:"",host:"",attending_count:"",interested_count:"",cover:""};try{const t=document.querySelector('[role="main"]')||document.body;console.log("üîç [FOMO Bookmarklet] === STRAT√âGIE STRUCTURE CONTENEUR ===");const o=t.querySelectorAll("h1");for(const x of o){const b=x.textContent.trim();if(!b||3>b.length||b.length>200)continue;let F=x.parentElement,B=0;const y=6;for(;F&&y>B;){const w=Array.from(F.children).filter(e=>"DIV"===e.tagName&&e.children.length>0);if(w.length>=3){const C=w.find(e=>e.contains(x));if(C){const S=w.indexOf(C);if(w[0]&&!e.start){const E=w[0].textContent.trim();E&&E.length>5&&console.log("üìÖ [FOMO Bookmarklet] Date trouv√©e via structure:",E)}if(!e.title&&b&&(e.title=b,console.log("‚úÖ [FOMO Bookmarklet] Titre trouv√© via structure:",b)),w.length>S+1){const D=w[S+1].textContent.trim();if(D&&D.length>=2&&200>D.length&&(!e.title||D.toLowerCase()!==e.title.toLowerCase()&&!D.toLowerCase().includes(e.title.toLowerCase())&&!e.title.toLowerCase().includes(D.toLowerCase())))if(D.includes(",")){const T=D.split(",").map(e=>e.trim());if(T.length>=2){const N=T[T.length-2];N&&N.length>=2&&100>N.length&&(e.venue_name||(e.venue_name=N,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu (ville) trouv√© via structure:",N)),e.address||(e.address=D,console.log("‚úÖ [FOMO Bookmarklet] Adresse trouv√©e via structure:",D)))}}else e.venue_name||(e.venue_name=D,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu trouv√© via structure:",D))}if(e.title){console.log("‚úÖ [FOMO Bookmarklet] Structure conteneur identifi√©e et exploit√©e");break}}}F=F.parentElement,B++}if(e.title)break}if(!e.title){const A=document.querySelector('h1[data-testid="event-permalink-event-name"]');if(A&&A.textContent.trim())e.title=A.textContent.trim();else{const I=t.querySelectorAll("h1");for(const L of I){const _=L.textContent.trim();if(_&&_.length>3&&200>_.length){e.title=_;break}}}}const n=t.querySelectorAll('[role="button"]');let r=!1;for(const q of n){const j=q.textContent.trim().toLowerCase(),R="voir plus"===j||"en voir plus"===j||"see more"===j||j.includes("voir plus")||j.includes("see more"),z="voir moins"===j||"see less"===j||j.includes("moins")||j.includes("less");if(R&&!z)try{console.log('üîΩ [FOMO Bookmarklet] Clic sur bouton "Voir plus" pour d√©plier la description:',j),q.click(),r=!0,await new Promise(e=>setTimeout(e,500));break}catch(H){console.warn('‚ö†Ô∏è [FOMO Bookmarklet] Erreur lors du clic sur "Voir plus":',H)}}r||console.log('‚ÑπÔ∏è [FOMO Bookmarklet] Aucun bouton "Voir plus" trouv√© ou description d√©j√† d√©pli√©e'),console.log("üìù [FOMO Bookmarklet] === D√âBUT EXTRACTION DESCRIPTION ===");let s=null;const l=t.querySelectorAll("div.html-div.xdj266r.x14z9mp.xat24cr.x1lziwak");console.log("üìù [FOMO Bookmarklet] Nombre de divs html-div.xdj266r trouv√©s:",l.length);for(const K of l){const $=K.querySelector('span[dir="auto"][class*="xdmh292"][class*="x15dsfln"][class*="x140p0ai"]');if($){const U=$.querySelector("div.xdj266r.x14z9mp.xat24cr.x1lziwak.x1vvkbs"),V=$.querySelectorAll("div.x14z9mp.xat24cr.x1lziwak.x1vvkbs.xtlvy1s").length>0;if(U||V){s=$,console.log("üìù [FOMO Bookmarklet] ‚úÖ Span trouv√© dans div parent html-div");break}}}if(s||(s=t.querySelector('span[dir="auto"][class*="xdmh292"][class*="x15dsfln"][class*="x140p0ai"]')),s){console.log("üìù [FOMO Bookmarklet] ‚úÖ Span multi-paragraphes trouv√©"),console.log("üìù [FOMO Bookmarklet] Contenu HTML du span (premiers 500 caract√®res):",s.innerHTML.substring(0,500));const P=s.cloneNode(!0),X=P.querySelectorAll('[role="button"], button, [class*="button"]');console.log("üìù [FOMO Bookmarklet] Nombre de boutons trouv√©s:",X.length);let Y=0;X.forEach(e=>{const t=e.textContent.trim().toLowerCase();(t.includes("voir moins")||t.includes("voir plus")||t.includes("en savoir plus")||t.includes("see more")||t.includes("see less")||"voir plus"===t||"voir moins"===t||"plus"===t||"moins"===t||"more"===t||"less"===t)&&(e.remove(),Y++)}),console.log("üìù [FOMO Bookmarklet] Boutons supprim√©s:",Y);const J=e=>{const t=e.cloneNode(!0);return t.querySelectorAll("img[alt]").forEach(e=>{const t=e.getAttribute("alt")||"";if(e.parentNode){const o=document.createTextNode(t);try{e.parentNode.replaceChild(o,e)}catch(e){console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Erreur remplacement emoji:",e)}}}),t.querySelectorAll("br, br.html-br").forEach(e=>{if(e.parentNode){const t=document.createTextNode("\n");try{e.parentNode.replaceChild(t,e)}catch(e){console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Erreur remplacement <br>:",e)}}}),t.textContent.trim()},G=[],W=P.querySelectorAll("div.xdj266r.x14z9mp.xat24cr.x1lziwak.x1vvkbs");if(console.log("üìù [FOMO Bookmarklet] Nombre de divs xdj266r trouv√©s:",W.length),W.length>0){const te=W[0],oe=J(te);console.log("üìù [FOMO Bookmarklet] Premier div (xdj266r) trouv√©"),console.log("üìù [FOMO Bookmarklet] Texte du premier div (avec emojis):",oe),console.log("üìù [FOMO Bookmarklet] HTML du premier div (premiers 200 caract√®res):",te.innerHTML.substring(0,200)),oe&&oe.length>0?(G.push(oe),console.log("üìù [FOMO Bookmarklet] ‚úÖ Premier paragraphe ajout√© (longueur:",oe.length,")")):console.warn("üìù [FOMO Bookmarklet] ‚ö†Ô∏è Premier div trouv√© mais texte vide apr√®s trim")}else console.log("üìù [FOMO Bookmarklet] ‚ö†Ô∏è Aucun div xdj266r trouv√©");const Z=P.querySelectorAll("div.x14z9mp.xat24cr.x1lziwak.x1vvkbs.xtlvy1s");if(console.log("üìù [FOMO Bookmarklet] Nombre de divs xtlvy1s trouv√©s:",Z.length),console.log("üìù [FOMO Bookmarklet] Extraction de tous les paragraphes dans l'ordre du DOM..."),Z.forEach((e,t)=>{const o=J(e);console.log(`üìù [FOMO Bookmarklet] Div xtlvy1s ${t+1}/${Z.length} texte complet (avec emojis):`,o),console.log(`üìù [FOMO Bookmarklet] Div xtlvy1s ${t+1} HTML (premiers 200 caract√®res):`,e.innerHTML.substring(0,200)),o&&o.length>0?(G.push(o),console.log(`üìù [FOMO Bookmarklet] ‚úÖ Paragraphe ${G.length} ajout√© (longueur: ${o.length})`)):console.warn(`üìù [FOMO Bookmarklet] ‚ö†Ô∏è Div xtlvy1s ${t+1} trouv√© mais texte vide apr√®s trim`)}),console.log("üìù [FOMO Bookmarklet] Total paragraphes extraits:",G.length),0===G.length){console.log("üìù [FOMO Bookmarklet] Aucun paragraphe structur√© trouv√©, recherche fallback dans tous les divs...");const ne=P.querySelectorAll("div.x14z9mp.xat24cr.x1lziwak.x1vvkbs");console.log("üìù [FOMO Bookmarklet] Nombre total de divs x14z9mp.xat24cr.x1lziwak.x1vvkbs trouv√©s:",ne.length),ne.forEach((e,t)=>{const o=J(e);o&&o.length>10&&(G.push(o),console.log(`üìù [FOMO Bookmarklet] ‚úÖ Paragraphe fallback ${G.length} ajout√© (avec emojis):`,o.substring(0,50)))})}let Q="";G.length>0?(Q=G.join("\n\n"),console.log("üìù [FOMO Bookmarklet] Total paragraphes concat√©n√©s:",G.length),console.log("üìù [FOMO Bookmarklet] Texte avant nettoyage (premiers 500 caract√®res):",Q.substring(0,500))):(Q=P.textContent.trim(),console.log("üìù [FOMO Bookmarklet] ‚ö†Ô∏è Aucun paragraphe structur√© trouv√©, utilisation du texte direct"),console.log("üìù [FOMO Bookmarklet] Texte direct (premiers 500 caract√®res):",Q.substring(0,500)));const ee=Q;Q=Q.replace(/\s*(voir\s+(plus|moins)|en\s+savoir\s+plus|see\s+(more|less))\s*/gi,""),Q=Q.replace(/\n{3,}/g,"\n\n").trim(),ee!==Q&&console.log("üìù [FOMO Bookmarklet] Texte nettoy√© (diff√©rences d√©tect√©es)"),Q&&Q.length>20?(e.description=Q.substring(0,2e3),console.log("‚úÖ [FOMO Bookmarklet] Description assign√©e √† data.description"),console.log("üìù [FOMO Bookmarklet] Longueur totale:",Q.length),console.log("üìù [FOMO Bookmarklet] Description finale (premiers 500 caract√®res):",e.description.substring(0,500)),console.log("üìù [FOMO Bookmarklet] Description finale (derniers 200 caract√®res):",e.description.substring(Math.max(0,e.description.length-200)))):(console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Texte extrait trop court ou vide"),console.warn("üìù [FOMO Bookmarklet] Longueur du texte:",Q?Q.length:0),console.warn("üìù [FOMO Bookmarklet] Contenu du texte:",Q))}else{console.log("‚ÑπÔ∏è [FOMO Bookmarklet] ‚ùå Span multi-paragraphes non trouv√©"),console.log("üìù [FOMO Bookmarklet] Recherche dans mainContent:",t?"trouv√©":"non trouv√©");const re=t.querySelectorAll('span[dir="auto"]');console.log('üìù [FOMO Bookmarklet] Nombre total de spans dir="auto" trouv√©s:',re.length)}if(console.log("üìù [FOMO Bookmarklet] === FIN EXTRACTION DESCRIPTION ==="),console.log("üìù [FOMO Bookmarklet] Description finale dans data.description:",e.description||"VIDE"),!e.description){const se=['[data-testid="event-permalink-details"]','[data-testid="event-permalink-description"]','[data-testid="event-permalink-about"]','[data-testid="event-permalink-event-description"]'];for(const le of se){const ae=document.querySelector(le);if(ae){const ie=ae.textContent.trim();if(ie&&ie.length>20){e.description=ie.substring(0,1e3);break}}}}if(!e.description){const ce=document.querySelector("div.xdj266r.x14z9mp.xat24cr.x1lziwak.x1vvkbs");if(ce){const de=ce.cloneNode(!0);de.querySelectorAll('[role="button"], button, [class*="button"]').forEach(e=>{const t=e.textContent.trim().toLowerCase();(t.includes("voir moins")||t.includes("voir plus")||t.includes("en savoir plus")||t.includes("see more")||t.includes("see less")||"voir plus"===t||"voir moins"===t||"plus"===t||"moins"===t||"more"===t||"less"===t)&&e.remove()});let ue=de.textContent.trim();ue=ue.replace(/\s*(voir\s+(plus|moins)|en\s+savoir\s+plus|see\s+(more|less))\s*/gi,""),ue=ue.replace(/\s+/g," ").trim(),ue&&ue.length>20&&(e.description=ue.substring(0,1e3),console.log("üìù [FOMO Bookmarklet] Description trouv√©e via div sp√©cifique:",ue.substring(0,100)))}}if(!e.description){const me=t.querySelectorAll('div[class*="xdj266r"], div[class*="x14z9mp"]');for(const pe of me){const ke=pe.cloneNode(!0);ke.querySelectorAll('[role="button"], button, [class*="button"]').forEach(e=>{const t=e.textContent.trim().toLowerCase();(t.includes("voir moins")||t.includes("voir plus")||t.includes("en savoir plus")||t.includes("see more")||t.includes("see less")||"voir plus"===t||"voir moins"===t||"plus"===t||"moins"===t||"more"===t||"less"===t)&&e.remove()});let Oe=ke.textContent.trim();if(Oe=Oe.replace(/\s*(voir\s+(plus|moins)|en\s+savoir\s+plus|see\s+(more|less))\s*/gi,""),Oe=Oe.replace(/\s+/g," ").trim(),Oe&&Oe.length>50&&2e3>Oe.length&&!Oe.match(/^https?:\/\//)&&Oe.split(/\s+/).length>10){e.description=Oe.substring(0,1e3);break}}}if(!e.description){const ge=t.querySelectorAll('div[dir="auto"]');let ve="";for(const fe of ge){const he=fe.cloneNode(!0);he.querySelectorAll('[role="button"], button, [class*="button"]').forEach(e=>{const t=e.textContent.trim().toLowerCase();(t.includes("voir moins")||t.includes("voir plus")||t.includes("en savoir plus")||t.includes("see more")||t.includes("see less")||"voir plus"===t||"voir moins"===t||"plus"===t||"moins"===t||"more"===t||"less"===t)&&e.remove()});let Me=he.textContent.trim();Me=Me.replace(/\s*(voir\s+(plus|moins)|en\s+savoir\s+plus|see\s+(more|less))\s*/gi,""),Me=Me.replace(/\s+/g," ").trim(),Me&&Me.length>50&&2e3>Me.length&&!Me.match(/^https?:\/\//)&&Me.split(/\s+/).length>10&&Me.length>ve.length&&(ve=Me)}ve&&(e.description=ve.substring(0,1e3))}console.log("üìÖ [FOMO Bookmarklet] === D√âBUT EXTRACTION DATES ==="),console.log('üìÖ [FOMO Bookmarklet] Strat√©gie 0: Recherche span sp√©cifique avec format "du X mois. HH:MM au X mois. HH:MM"...');const a=t.querySelector('span[dir="auto"][class*="xdmh292"][class*="x15dsfln"][class*="x140p0ai"][class*="x1yc453h"][class*="x1a1m0xk"][class*="x1xlr1w8"]');if(a){const xe=a.textContent.trim();console.log("üìÖ [FOMO Bookmarklet] Texte trouv√© dans span sp√©cifique:",xe);const be=xe.match(/du\s+(\d{1,2})\s+(\w+)\.\s+(\d{1,2}):(\d{2})\s+au\s+(\d{1,2})\s+(\w+)\.\s+(\d{1,2}):(\d{2})/i);if(be){const[,Fe,Be,ye,we,Ce,Se,Ee,De]=be;console.log("üìÖ [FOMO Bookmarklet] Match trouv√©:",{startDay:Fe,startMonthAbbr:Be,startHour:ye,startMinute:we,endDay:Ce,endMonthAbbr:Se,endHour:Ee,endMinute:De});const Te={janv:0,jan:0,"f√©vr":1,"f√©v":1,mars:2,mar:2,avr:3,mai:4,juin:5,juil:6,jul:6,"ao√ªt":7,aout:7,sept:8,oct:9,nov:10,"d√©c":11,dec:11,jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11},Ne=Te[Be.toLowerCase()],Ae=Te[Se.toLowerCase()];if(void 0!==Ne&&void 0!==Ae){const Ie=new Date;let Le=Ie.getFullYear();(Ne<Ie.getMonth()||Ne===Ie.getMonth()&&parseInt(Fe)<Ie.getDate())&&(Le+=1);const _e=new Date(Le,Ne,parseInt(Fe),parseInt(ye),parseInt(we)),qe=new Date(Le,Ae,parseInt(Ce),parseInt(Ee),parseInt(De));console.log("üìÖ [FOMO Bookmarklet] Dates cr√©√©es - D√©but:",_e,"Fin:",qe),isNaN(_e.getTime())||isNaN(qe.getTime())?console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Dates invalides apr√®s parsing"):(e.start=_e.toISOString(),e.end=qe.toISOString(),console.log("‚úÖ [FOMO Bookmarklet] Date d√©but extraite:",e.start),console.log("‚úÖ [FOMO Bookmarklet] Date fin extraite:",e.end))}else console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Mois non reconnus:",Be,Se)}else console.log('üìÖ [FOMO Bookmarklet] Format "du X mois. HH:MM au X mois. HH:MM" non d√©tect√© dans le texte')}else console.log("üìÖ [FOMO Bookmarklet] Span sp√©cifique non trouv√©");console.log("üìÖ [FOMO Bookmarklet] Strat√©gie 1: Recherche dans JSON-LD...");const i=document.querySelectorAll('script[type="application/ld+json"]');console.log("üìÖ [FOMO Bookmarklet] Nombre de scripts JSON-LD trouv√©s:",i.length);for(const je of i)try{const Re=JSON.parse(je.textContent);if("Event"===Re["@type"]||Array.isArray(Re)&&Re.find(e=>"Event"===e["@type"])){const ze=Array.isArray(Re)?Re.find(e=>"Event"===e["@type"]):Re;console.log("üìÖ [FOMO Bookmarklet] √âv√©nement trouv√© dans JSON-LD:",{startDate:ze.startDate,endDate:ze.endDate}),ze.startDate&&(e.start=new Date(ze.startDate).toISOString(),console.log("‚úÖ [FOMO Bookmarklet] Date d√©but extraite depuis JSON-LD:",e.start)),ze.endDate&&(e.end=new Date(ze.endDate).toISOString(),console.log("‚úÖ [FOMO Bookmarklet] Date fin extraite depuis JSON-LD:",e.end));break}}catch(He){console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Erreur parsing JSON-LD:",He)}if(!e.start){console.log("üìÖ [FOMO Bookmarklet] Strat√©gie 2: Recherche dans spans avec classes sp√©cifiques...");const Ke=t.querySelectorAll('span[dir="auto"][class*="xdmh292"], span[dir="auto"][class*="x15dsfln"]');console.log("üìÖ [FOMO Bookmarklet] Nombre de spans avec classes sp√©cifiques trouv√©s:",Ke.length);let $e="";for(const Ue of Ke){const Ve=Ue.textContent.trim();if(Ve&&(Ve.includes("de")&&Ve.includes("√†")&&Ve.match(/\d{1,2}\s+\w+\s+\d{4}/)||Ve.includes("√†")&&Ve.match(/\d{1,2}\s+\w+\s+\d{4}/)||Ve.match(/\d{1,2}\/\d{1,2}\/\d{4}/)||Ve.match(/\d{4}-\d{2}-\d{2}/)||/(aujourd'hui|demain|today|tomorrow)/i.test(Ve))){$e=Ve,console.log("üìÖ [FOMO Bookmarklet] Date trouv√©e via span sp√©cifique:",Ve);break}}if(!$e){console.log("üìÖ [FOMO Bookmarklet] Recherche dans attributs data-testid et aria-label...");const Pe=['[data-testid="event-permalink-event-time"]','[data-testid="event-time"]','[aria-label*="Date"]','[aria-label*="date"]'];for(const Xe of Pe){const Ye=document.querySelectorAll(Xe);console.log(`üìÖ [FOMO Bookmarklet] S√©lecteur "${Xe}": ${Ye.length} √©l√©ments trouv√©s`);for(const Je of Ye){const Ge=Je.textContent.trim()||Je.getAttribute("aria-label")||"";if(Ge&&(Ge.includes("√†")||Ge.match(/\d{1,2}\s+\w+\s+\d{4}/)||Ge.match(/\d{1,2}\/\d{1,2}\/\d{4}/)||Ge.match(/\d{4}-\d{2}-\d{2}/)||/(aujourd'hui|demain|today|tomorrow)/i.test(Ge))){$e=Ge,console.log("üìÖ [FOMO Bookmarklet] Date trouv√©e via attribut:",Ge);break}}if($e)break}}if(!$e){console.log('üìÖ [FOMO Bookmarklet] Strat√©gie 3: Recherche dans tous les spans dir="auto"...');const We=document.querySelectorAll('span[dir="auto"]');console.log('üìÖ [FOMO Bookmarklet] Nombre de spans dir="auto" trouv√©s:',We.length);for(const Ze of We){const Qe=Ze.textContent.trim();if(Qe&&(Qe.includes("√†")||Qe.match(/\d{1,2}\s+\w+\s+\d{4}/)||Qe.match(/\d{1,2}\/\d{1,2}\/\d{4}/)||/(aujourd'hui|demain|today|tomorrow)/i.test(Qe))){$e=Qe,console.log('üìÖ [FOMO Bookmarklet] Date trouv√©e via span dir="auto":',Qe);break}}}if($e)try{console.log("üìÖ [FOMO Bookmarklet] Texte de date √† parser:",$e);let et=$e.match(/(\d{4}-\d{2}-\d{2}[T\s]\d{2}:\d{2})/);if(et){console.log("üìÖ [FOMO Bookmarklet] Format ISO d√©tect√©, match:",et[1]);const tt=new Date(et[1]);isNaN(tt.getTime())?console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Date ISO invalide apr√®s parsing:",et[1]):(e.start=tt.toISOString(),console.log("‚úÖ [FOMO Bookmarklet] Date ISO pars√©e avec succ√®s:",e.start))}else if(/(aujourd'hui|today)/i.test($e)||/(demain|tomorrow)/i.test($e)){console.log("üìÖ [FOMO Bookmarklet] Format relatif d√©tect√© (Aujourd'hui/Demain)");let ot=new Date(new Date);/(demain|tomorrow)/i.test($e)?(ot.setDate(ot.getDate()+1),console.log("üìÖ [FOMO Bookmarklet] Date relative: Demain")):console.log("üìÖ [FOMO Bookmarklet] Date relative: Aujourd'hui");const nt=$e.match(/de\s+(\d{1,2}):(\d{2})\s+√†\s+(\d{1,2}):(\d{2})/i);if(nt){const[,rt,st,lt,at]=nt;ot.setHours(parseInt(rt),parseInt(st),0,0),e.start=ot.toISOString(),console.log("‚úÖ [FOMO Bookmarklet] Date relative pars√©e (d√©but avec plage):",e.start);const it=new Date(ot);it.setHours(parseInt(lt),parseInt(at),0,0),e.end=it.toISOString(),console.log("‚úÖ [FOMO Bookmarklet] Date relative pars√©e (fin avec plage):",e.end)}else{const ct=$e.match(/√†\s+(\d{1,2}):(\d{2})/i);if(ct){const[,dt,ut]=ct;ot.setHours(parseInt(dt),parseInt(ut),0,0),e.start=ot.toISOString(),console.log("‚úÖ [FOMO Bookmarklet] Date relative pars√©e (d√©but simple):",e.start)}else console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Format relatif d√©tect√© mais heure non trouv√©e")}}else{console.log("üìÖ [FOMO Bookmarklet] Format ISO non d√©tect√©, tentative parsing format fran√ßais...");const mt={janvier:0,"f√©vrier":1,mars:2,avril:3,mai:4,juin:5,juillet:6,"ao√ªt":7,septembre:8,octobre:9,novembre:10,"d√©cembre":11,january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11};let pt=$e.match(/(\d{1,2})\s+(\w+)\s+(\d{4})\s+de\s+(\d{1,2}):(\d{2})\s+√†\s+(\d{1,2}):(\d{2})/i);if(pt||(pt=$e.match(/(\d{1,2})\s+(\w+)\s+(\d{4}).*?(\d{1,2}):(\d{2})\s+√†\s+(\d{1,2}):(\d{2})/i)),pt){const[,kt,Ot,gt,vt,ft,ht,Mt]=pt;console.log("üìÖ [FOMO Bookmarklet] Match avec range trouv√©:",{day:kt,monthName:Ot,year:gt,startHour:vt,startMinute:ft,endHour:ht,endMinute:Mt});const xt=mt[Ot.toLowerCase()];if(console.log("üìÖ [FOMO Bookmarklet] Mois recherch√©:",Ot.toLowerCase(),"‚Üí Index:",xt),void 0!==xt){const bt=new Date(parseInt(gt),xt,parseInt(kt),parseInt(vt),parseInt(ft)),Ft=new Date(parseInt(gt),xt,parseInt(kt),parseInt(ht),parseInt(Mt));console.log("üìÖ [FOMO Bookmarklet] Dates cr√©√©es - D√©but:",bt,"Fin:",Ft),isNaN(bt.getTime())||isNaN(Ft.getTime())?console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Dates invalides apr√®s parsing - D√©but valide:",!isNaN(bt.getTime()),"Fin valide:",!isNaN(Ft.getTime())):(e.start=bt.toISOString(),e.end=Ft.toISOString(),console.log("‚úÖ [FOMO Bookmarklet] Date de d√©but extraite:",e.start),console.log("‚úÖ [FOMO Bookmarklet] Date de fin extraite:",e.end))}else console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Mois non reconnu:",Ot,"(mois disponibles:",Object.keys(mt).join(", "),")")}else{console.log("üìÖ [FOMO Bookmarklet] Format avec range non d√©tect√©, tentative format simple...");let Bt=$e.match(/(\d{1,2})\s+(\w+)\s+(\d{4}).*?(\d{1,2}):(\d{2})/);if(Bt){const[,yt,wt,Ct,St,Et]=Bt;console.log("üìÖ [FOMO Bookmarklet] Match format fran√ßais simple trouv√©:",{day:yt,monthName:wt,year:Ct,hour:St,minute:Et});const Dt=mt[wt.toLowerCase()];if(console.log("üìÖ [FOMO Bookmarklet] Mois recherch√©:",wt.toLowerCase(),"‚Üí Index:",Dt),void 0!==Dt){const Tt=new Date(parseInt(Ct),Dt,parseInt(yt),parseInt(St),parseInt(Et));console.log("üìÖ [FOMO Bookmarklet] Date cr√©√©e:",Tt),isNaN(Tt.getTime())?console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Date invalide apr√®s parsing format fran√ßais"):(e.start=Tt.toISOString(),console.log("‚úÖ [FOMO Bookmarklet] Date simple extraite (format fran√ßais):",e.start))}else console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Mois non reconnu dans format simple:",wt)}else if(console.log("üìÖ [FOMO Bookmarklet] Tentative format num√©rique (DD/MM/YYYY)..."),Bt=$e.match(/(\d{1,2})\/(\d{1,2})\/(\d{4}).*?(\d{1,2}):(\d{2})/),Bt){const[,Nt,At,It,Lt,_t]=Bt;console.log("üìÖ [FOMO Bookmarklet] Match format num√©rique trouv√©:",{day:Nt,month:At,year:It,hour:Lt,minute:_t});const qt=new Date(parseInt(It),parseInt(At)-1,parseInt(Nt),parseInt(Lt),parseInt(_t));console.log("üìÖ [FOMO Bookmarklet] Date cr√©√©e:",qt),isNaN(qt.getTime())?console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Date invalide apr√®s parsing format num√©rique"):(e.start=qt.toISOString(),console.log("‚úÖ [FOMO Bookmarklet] Date simple extraite (format num√©rique):",e.start))}else console.log("üìÖ [FOMO Bookmarklet] Format num√©rique non d√©tect√©")}}if(e.start&&!e.end){console.log("üìÖ [FOMO Bookmarklet] Date d√©but trouv√©e mais pas de fin, recherche dur√©e...");const jt=$e.match(/(\d+)\s*(heure|hour|h|minute|min)/i);if(jt){const Rt=parseInt(jt[1]),zt=jt[2].toLowerCase();console.log("üìÖ [FOMO Bookmarklet] Dur√©e trouv√©e:",Rt,zt);const Ht=new Date(e.start);zt.includes("heure")||zt.includes("hour")||"h"===zt?(Ht.setHours(Ht.getHours()+Rt),console.log("üìÖ [FOMO Bookmarklet] Ajout de",Rt,"heures √† la date de d√©but")):(zt.includes("minute")||zt.includes("min"))&&(Ht.setMinutes(Ht.getMinutes()+Rt),console.log("üìÖ [FOMO Bookmarklet] Ajout de",Rt,"minutes √† la date de d√©but")),isNaN(Ht.getTime())?console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Date de fin invalide apr√®s calcul depuis dur√©e"):(e.end=Ht.toISOString(),console.log("‚úÖ [FOMO Bookmarklet] Date de fin calcul√©e depuis dur√©e:",e.end))}else console.log("üìÖ [FOMO Bookmarklet] Aucune dur√©e trouv√©e dans le texte")}}catch(Kt){console.error("‚ùå [FOMO Bookmarklet] Erreur parsing date:",Kt,$e),console.error("‚ùå [FOMO Bookmarklet] Stack trace:",Kt.stack)}else console.warn("‚ö†Ô∏è [FOMO Bookmarklet] Aucun texte de date trouv√© pour parsing")}console.log("üìÖ [FOMO Bookmarklet] === R√âSUM√â EXTRACTION DATES ==="),console.log("üìÖ [FOMO Bookmarklet] Date d√©but:",e.start||"NON TROUV√âE"),console.log("üìÖ [FOMO Bookmarklet] Date fin:",e.end||"NON TROUV√âE"),console.log("üìÖ [FOMO Bookmarklet] === FIN EXTRACTION DATES ==="),console.log("üìç [FOMO Bookmarklet] === D√âBUT EXTRACTION ADRESSE ===");let c=null;const d=document.querySelector('h1[data-testid="event-permalink-event-name"]')||t.querySelector("h1");if(d){let $t=d.parentElement,Ut=0;for(;$t&&10>Ut;){const Vt=$t.querySelector('span[dir="auto"][class*="xdmh292"][class*="x15dsfln"][class*="x140p0ai"]'),Pt=$t.querySelector('span[dir="auto"][class*="xdmh292"][class*="x15dsfln"][class*="x1yc453h"]');if(Vt||Pt){c=$t,console.log("üìç [FOMO Bookmarklet] Conteneur √©v√©nement trouv√©");break}$t=$t.parentElement,Ut++}}const u=c;u?console.log("üìç [FOMO Bookmarklet] Zone de recherche: conteneur √©v√©nement"):console.warn("üìç [FOMO Bookmarklet] ‚ö†Ô∏è Conteneur √©v√©nement non trouv√© - recherche d'adresse d√©sactiv√©e pour √©viter les faux positifs");const m=u||t;if(!e.venue_name||!e.address){console.log("üìç [FOMO Bookmarklet] Strat√©gie 0: Recherche via aria-label de localisation...");const Xt=m.querySelector('div[aria-label*="Informations de localisation"], div[aria-label*="localisation"]');if(Xt){console.log("‚úÖ [FOMO Bookmarklet] Div de localisation trouv√© via aria-label");const Yt=Xt.querySelector('a[role="link"]');if(Yt){console.log("‚úÖ [FOMO Bookmarklet] Lien trouv√© dans le div de localisation");const Jt=Yt.querySelectorAll('span[dir="auto"]'),Gt=[];for(const Zt of Jt){const Qt=Zt.textContent.trim();Qt&&Qt.length>2&&200>Qt.length&&!Gt.includes(Qt)&&Gt.push(Qt)}const Wt=Yt.querySelectorAll("div.xu06os2.x1ok221b");if(Wt.length>=2){const eo=Wt[0],to=Wt[1],oo=eo.textContent.trim(),no=to.textContent.trim();oo&&oo.length>2&&200>oo.length&&no&&no.length>5&&200>no.length&&(e.title&&(oo.toLowerCase()===e.title.toLowerCase()||oo.toLowerCase().includes(e.title.toLowerCase())||e.title.toLowerCase().includes(oo.toLowerCase()))||(no.includes(",")||/(rue|avenue|boulevard|place|chemin|route|all√©e|impasse|street|road|way|drive|france|belgium|belgique)/i.test(no))&&(e.venue_name||(e.venue_name=oo,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu trouv√© via lien (divs):",oo)),e.address||(e.address=no,console.log("‚úÖ [FOMO Bookmarklet] Adresse trouv√©e via lien (divs):",no))))}if(e.venue_name&&e.address||2>Gt.length){if(1===Gt.length&&!e.address){const ro=Gt[0];(ro.includes(",")||/(rue|avenue|boulevard|place|chemin|route|all√©e|impasse|street|road|way|drive|france|belgium|belgique)/i.test(ro))&&(e.address=ro,console.log("‚úÖ [FOMO Bookmarklet] Adresse trouv√©e via lien (texte unique):",ro))}}else{const so=Gt[0],lo=Gt[1];e.title&&(so.toLowerCase()===e.title.toLowerCase()||so.toLowerCase().includes(e.title.toLowerCase())||e.title.toLowerCase().includes(so.toLowerCase()))||(lo.includes(",")||/(rue|avenue|boulevard|place|chemin|route|all√©e|impasse|street|road|way|drive|france|belgium|belgique)/i.test(lo))&&(e.venue_name||(e.venue_name=so,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu trouv√© via lien (spans):",so)),e.address||(e.address=lo,console.log("‚úÖ [FOMO Bookmarklet] Adresse trouv√©e via lien (spans):",lo)))}}else console.log("‚ö†Ô∏è [FOMO Bookmarklet] Lien non trouv√© dans le div de localisation")}else{console.log("‚ö†Ô∏è [FOMO Bookmarklet] Div de localisation non trouv√© via aria-label, fallback sur recherche de liens...");const ao=m.querySelectorAll('a[role="link"]');console.log("üìç [FOMO Bookmarklet] Nombre de liens trouv√©s (fallback):",ao.length);for(const io of ao){const co=io.className;if(!co.includes("x1i10hfl")||!co.includes("x1qjc9v5"))continue;const uo=io.querySelectorAll('span[dir="auto"]'),mo=[];for(const ko of uo){const Oo=ko.textContent.trim();Oo&&Oo.length>2&&200>Oo.length&&!mo.includes(Oo)&&mo.push(Oo)}const po=io.querySelectorAll("div.xu06os2.x1ok221b");if(po.length>=2){const go=po[0],vo=po[1],fo=go.textContent.trim(),ho=vo.textContent.trim();if(fo&&fo.length>2&&200>fo.length&&ho&&ho.length>5&&200>ho.length&&(!e.title||fo.toLowerCase()!==e.title.toLowerCase()&&!fo.toLowerCase().includes(e.title.toLowerCase())&&!e.title.toLowerCase().includes(fo.toLowerCase()))&&(ho.includes(",")||/(rue|avenue|boulevard|place|chemin|route|all√©e|impasse|street|road|way|drive|france|belgium|belgique)/i.test(ho))){e.venue_name||(e.venue_name=fo,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu trouv√© via lien (fallback divs):",fo)),e.address||(e.address=ho,console.log("‚úÖ [FOMO Bookmarklet] Adresse trouv√©e via lien (fallback divs):",ho));break}}if(!(e.venue_name&&e.address||2>mo.length)){const Mo=mo[0],xo=mo[1];if((!e.title||Mo.toLowerCase()!==e.title.toLowerCase()&&!Mo.toLowerCase().includes(e.title.toLowerCase())&&!e.title.toLowerCase().includes(Mo.toLowerCase()))&&(xo.includes(",")||/(rue|avenue|boulevard|place|chemin|route|all√©e|impasse|street|road|way|drive|france|belgium|belgique)/i.test(xo))){e.venue_name||(e.venue_name=Mo,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu trouv√© via lien (fallback spans):",Mo)),e.address||(e.address=xo,console.log("‚úÖ [FOMO Bookmarklet] Adresse trouv√©e via lien (fallback spans):",xo));break}}}}}if(!e.venue_name&&m){console.log("üìç [FOMO Bookmarklet] Strat√©gie SVG: Recherche via ic√¥ne de localisation...");const bo=m.querySelectorAll("svg");console.log("üìç [FOMO Bookmarklet] Nombre de SVG trouv√©s:",bo.length);for(const Fo of bo){const Bo=Fo.querySelectorAll("path");let yo=!1;for(const wo of Bo){const Co=wo.getAttribute("d");if(Co&&Co.includes("M10 .5A7.5 7.5 0 0 0 2.5 8")){yo=!0,console.log("üìç [FOMO Bookmarklet] Ic√¥ne de localisation trouv√©e");break}}if(yo){let So=Fo.parentElement,Eo=0;const Do=5;for(;So&&Do>Eo;){const To=So.querySelectorAll('span, div[role="button"], a, p');for(const No of To){const Ao=No.textContent.trim();if(Ao&&Ao.length>=2&&200>=Ao.length&&(!e.title||Ao.toLowerCase()!==e.title.toLowerCase()&&!Ao.toLowerCase().includes(e.title.toLowerCase())&&!e.title.toLowerCase().includes(Ao.toLowerCase()))){if(!Ao.includes(",")){e.venue_name=Ao,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu trouv√© (nom simple):",Ao);break}{const Io=Ao.split(",").map(e=>e.trim());if(Io.length>=2){const Lo=Io[Io.length-2];if(Lo&&Lo.length>=2&&100>Lo.length){e.venue_name=Lo,console.log("‚úÖ [FOMO Bookmarklet] Nom du lieu extrait de l'adresse (ville):",Lo),console.log("üìç [FOMO Bookmarklet] Adresse compl√®te trouv√©e:",Ao),e.address||(e.address=Ao);break}}}}}if(e.venue_name)break;So=So.parentElement,Eo++}if(e.venue_name)break}}}console.log("üìç [FOMO Bookmarklet] Nom du lieu final:",e.venue_name||"NON TROUV√â"),console.log("üìç [FOMO Bookmarklet] === FIN EXTRACTION ADRESSE ==="),console.log("üìç [FOMO Bookmarklet] Adresse finale:",e.address||"NON TROUV√âE"),console.log("üë§ [FOMO Bookmarklet] === D√âBUT EXTRACTION ORGANISATEUR ===");const p=t.querySelectorAll("span");for(const _o of p){const qo=_o.textContent.trim();if(qo&&(qo.toLowerCase().includes("√©v√®nement de")||qo.toLowerCase().includes("event by")||qo.toLowerCase().includes("√©v√©nement de"))){const jo=_o.querySelectorAll("a"),Ro=[];for(const zo of jo){const Ho=zo.textContent.trim();Ho&&Ho.length>0&&Ro.push(Ho)}if(Ro.length>0){e.host=Ro.join(" et "),console.log("üë§ [FOMO Bookmarklet] ‚úÖ Organisateur(s) trouv√©(s):",e.host);break}}}console.log("üë§ [FOMO Bookmarklet] === FIN EXTRACTION ORGANISATEUR ==="),console.log("üë§ [FOMO Bookmarklet] Organisateur final:",e.host||"NON TROUV√â");const k=['img[data-imgperflogname="profileCoverPhoto"]','img[data-testid="event-cover-photo"]','img[alt*="cover"]','img[alt*="Cover"]','img[alt*="event cover"]'];for(const Ko of k){const $o=document.querySelector(Ko);if($o&&$o.src&&!$o.src.includes("data:image")){if("profileCoverPhoto"===$o.getAttribute("data-imgperflogname")){e.cover=$o.src,console.log("üñºÔ∏è [FOMO Bookmarklet] Image de couverture trouv√©e via profileCoverPhoto:",$o.src.substring(0,100));break}if($o.offsetWidth>400||$o.naturalWidth>400){e.cover=$o.src;break}}}if(!e.cover){const Uo=t.querySelectorAll("img");let Vo=null,Po=0;for(const Xo of Uo)if(Xo.src&&!Xo.src.includes("data:image")&&!Xo.src.includes("profile")&&!Xo.src.includes("avatar")&&!Xo.src.includes("icon")&&(!Xo.alt||!Xo.alt.toLowerCase().includes("profile"))){const Yo=Xo.getBoundingClientRect(),Jo=(Xo.offsetWidth||Xo.naturalWidth||Yo.width)*(Xo.offsetHeight||Xo.naturalHeight||Yo.height),Go=Yo.top,Wo=Jo/100+(1e3>Go?(1e3-Go)/10:0)+(Xo.src.includes("scontent")?100:0);Jo>5e4&&2e3>Go&&Wo>Po&&(Po=Wo,Vo=Xo)}if(Vo){let Zo=Vo.src;Zo.includes("scontent")&&Zo.includes("&")&&(Zo=Zo.split("&")[0]+"&ext="),e.cover=Zo}}function O(e){if(!e)return null;let t=e.replace(/\u00A0/g," ").trim().replace(/\s+/g," ");if(/^\d+$/.test(t))return t;const o=t.match(/^(\d+)[,.]?(\d+)?\s*K$/i);if(o){const[,e,t]=o;return t?`${e}.${t}K`.toUpperCase():(e+"K").toUpperCase()}const n=t.match(/^(\d+)[,.]?(\d+)?\s*M$/i);if(n){const[,e,t]=n;return t?`${e}.${t}M`.toUpperCase():(e+"M").toUpperCase()}return null}const g=t.querySelectorAll('span[dir="auto"][class*="xdmh292"], span[dir="auto"][class*="x15dsfln"]');for(const Qo of g){let en=Qo.textContent.trim(),tn=O(en);if(null===tn&&Qo.parentElement){const on=Qo.parentElement.textContent.trim();tn=O(on),null!==tn&&(en=on)}if(null!==tn){const nn=Qo.parentElement,rn=nn?nn.parentElement:null;let sn=[];if(nn&&sn.push(nn.textContent.trim().toLowerCase()),rn&&sn.push(rn.textContent.trim().toLowerCase()),nn){const an=Qo.previousElementSibling,cn=Qo.nextElementSibling;an&&sn.push(an.textContent.trim().toLowerCase()),cn&&sn.push(cn.textContent.trim().toLowerCase())}nn&&Array.from(nn.parentElement?nn.parentElement.children:[]).forEach(e=>{e!==nn&&sn.push(e.textContent.trim().toLowerCase())});const ln=sn.join(" ");(ln.includes("participant")||ln.includes("going")||ln.includes("vont")||ln.includes("participer")||ln.includes("personne")||ln.includes("va"))&&(e.attending_count||(e.attending_count=tn,console.log("üë• [FOMO Bookmarklet] Participants trouv√©s via span:",tn))),(ln.includes("int√©ress√©")||ln.includes("interested")||ln.includes("s'int√©resse"))&&(e.interested_count||(e.interested_count=tn,console.log("üëÄ [FOMO Bookmarklet] Int√©ress√©s trouv√©s via span:",tn)))}}const v=document.body.textContent||"",f=[/(\d+(?:[.,]\d+)?\s*[KM]?)\s*(personnes|people|participants|going|participent|vont|participeront)/i,/(\d+(?:[.,]\d+)?\s*[KM]?)\s*(personne|person|participant|va|participera)/i,/going[:\s]+(\d+(?:[.,]\d+)?\s*[KM]?)/i,/participants[:\s]+(\d+(?:[.,]\d+)?\s*[KM]?)/i];for(const dn of f){const un=v.match(dn);if(un){const mn=O(un[1].trim());null===mn||e.attending_count||(e.attending_count=mn);break}}const h=[/(\d+(?:[.,]\d+)?\s*[KM]?)\s*(int√©ress√©s|interested|int√©ress√©es|s'int√©ressent)/i,/(\d+(?:[.,]\d+)?\s*[KM]?)\s*(int√©ress√©|interested)/i,/interested[:\s]+(\d+(?:[.,]\d+)?\s*[KM]?)/i,/int√©ress√©s[:\s]+(\d+(?:[.,]\d+)?\s*[KM]?)/i];for(const pn of h){const kn=v.match(pn);if(kn){const On=O(kn[1].trim());null===On||e.interested_count||(e.interested_count=On);break}}const M=document.querySelectorAll('button, [role="button"]');for(const gn of M){const vn=gn.textContent.trim(),fn=vn.match(/(\d+(?:[.,]\d+)?\s*[KM]?)\s*(going|participants|vont)/i);if(fn){const Mn=O(fn[1].trim());null===Mn||e.attending_count||(e.attending_count=Mn)}const hn=vn.match(/(\d+(?:[.,]\d+)?\s*[KM]?)\s*(interested|int√©ress√©s)/i);if(hn){const xn=O(hn[1].trim());null===xn||e.interested_count||(e.interested_count=xn)}}}catch(bn){console.error("Erreur extraction donn√©es:",bn)}return console.log("üîç [FOMO Bookmarklet] Donn√©es extraites:",e),console.log("üîç [FOMO Bookmarklet] Champs remplis:",{title:!!e.title,description:!!e.description,start:!!e.start,end:!!e.end,venue_name:!!e.venue_name,address:!!e.address,host:!!e.host,cover:!!e.cover,attending_count:e.attending_count,interested_count:e.interested_count}),e}(),0,()=>{window.__FOMO_BOOKMARKLET_ACTIVE=!1})}catch(e){alert("Erreur: "+e.message),window.__FOMO_BOOKMARKLET_ACTIVE=!1}}()):alert("‚ö†Ô∏è Ce bookmarklet doit √™tre utilis√© sur une page d'√©v√©nement Facebook.\n\nOuvrez une page d'√©v√©nement Facebook (ex: facebook.com/events/...) puis r√©essayez.")}();